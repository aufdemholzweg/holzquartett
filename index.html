function createCard(cardData, isRevealed = true, isPlayer = true) {
            const card = document.createElement('div');
            // Added perspective class directly here if needed, or ensure parent has it.
            card.className = `card-3d w-full h-full relative ${isPlayer ? 'cursor-pointer hover-lift' : ''} transition-all duration-300`;
            if (!isRevealed) {
                card.classList.add('card-flipped');
            }

            const borderColor = isPlayer ? 'border-amber-400' : 'border-gray-300';
            const shadow = isPlayer ? 'shadow-lg' : 'shadow-md';
            const cardFront = document.createElement('div');
            // Added overflow-hidden to prevent button text wrapping issues
            cardFront.className = `card-front card-background rounded-xl ${shadow} border-2 ${borderColor} p-2 sm:p-3 flex flex-col overflow-hidden`;

            // Determine if attributes should be clickable buttons
             const canSelectAttributes = isPlayer && (
                (gameMode === 'ai' && !aiGame.roundInProgress) ||
                (gameMode === 'multiplayer' && localGameState?.turn === localPlayerId && !localGameState?.lastResult) // Check localGameState safely
            );

             // Determine if the info button should be shown (player card, after round)
             const showInfoButton = isPlayer && (
                 (gameMode === 'ai' && aiGame.roundInProgress) ||
                 (gameMode === 'multiplayer' && !!localGameState?.lastResult) // Check localGameState safely
             );

             // Use optional chaining and default values for cardData properties
             const cardName = cardData?.name || 'Unbekannt';
             const safeCardNameId = cardName.replace(/[^a-zA-Z0-9]/g, '-') || 'unknown'; // Sanitize for ID


             // ===== NEU: Button/Icon-Logik angepasst =====
             let headerRightContent = '';
             if (isPlayer) {
                 const woodData = woodInfo[cardName] || {}; // Use fetched cardName
                 const treeImage = woodData.bildBaum || 'https://placehold.co/36x36/d1d5db/374151?text=?';

                 // Both icon and button share the same container, visibility toggled by 'hidden'
                 headerRightContent = `
                    <div class="flex-shrink-0 relative w-8 h-8 sm:w-9 sm:w-9"> <img src="${treeImage}" alt="${cardName}"
                             id="wood-image-icon-${safeCardNameId}"
                             class="${showInfoButton ? 'hidden' : ''} absolute inset-0 w-full h-full object-cover rounded-full border-2 border-amber-200">
                        <button id="player-info-button-${safeCardNameId}"
                                onclick="window.showWoodInfo('${cardName.replace(/'/g, "\\'")}')"  // Escape single quotes in name
                                class="${showInfoButton ? '' : 'hidden'} absolute inset-0 bg-purple-600 text-white rounded-full flex items-center justify-center text-lg hover:bg-purple-700 z-10">ðŸ’¡</button>
                    </div>
                 `;
             }
             // ===== ENDE NEU =====

             // --- Attribute List/Buttons (unverÃ¤ndert) ---
            let attributeHTML = '<div class="space-y-1 mt-auto">';
            for (const attrKey in attributeInfo) {
                if (Object.hasOwnProperty.call(attributeInfo, attrKey)) {
                    const attr = attributeInfo[attrKey];
                    const value = cardData?.[attrKey] ?? '?';
                    const formattedValue = typeof value === 'number' ? value.toLocaleString('de-DE') : value;
                    const valueUnit = attr.name.match(/\(([^)]+)\)/);
                    const unitText = valueUnit ? `<span class="block text-[10px] sm:text-xs text-gray-500 leading-tight">${valueUnit[0]}</span>` : '';
                    const nameText = attr.name.replace(/\s*\(([^)]+)\)/, '');

                    const commonClasses = "w-full flex justify-between items-center py-0.5 sm:py-1 px-1 rounded-lg text-left border";
                    const displayClasses = "bg-amber-50 border-amber-300";
                    const buttonClasses = "bg-amber-100 hover:bg-amber-200 border-amber-600 transition-colors";

                    if (canSelectAttributes) {
                        attributeHTML += `
                            <button onclick="window.selectAttribute('${attrKey}')" class="${commonClasses} ${buttonClasses}">
                                <div class="flex items-center space-x-1 sm:space-x-2">
                                   <span class="text-xs sm:text-sm">${attr.icon}</span>
                                   <div>
                                       <span class="text-[11px] sm:text-xs font-medium leading-tight">${nameText}</span>
                                       ${unitText}
                                   </div>
                                </div>
                                <span class="font-semibold text-amber-700 text-sm sm:text-base">${formattedValue}</span>
                            </button>`;
                    } else {
                        attributeHTML += `
                            <div class="${commonClasses} ${displayClasses}">
                                 <div class="flex items-center space-x-1 sm:space-x-2">
                                   <span class="text-xs sm:text-sm">${attr.icon}</span>
                                   <div>
                                       <span class="text-[11px] sm:text-xs font-medium leading-tight text-gray-700">${nameText}</span>
                                        ${unitText}
                                   </div>
                                </div>
                                <span class="font-semibold text-amber-800 text-sm sm:text-base">${formattedValue}</span>
                            </div>`;
                    }
                }
            }
            attributeHTML += '</div>';
             // --- End Attribute List/Buttons ---


            // ===== NEU: Angepasste cardFront.innerHTML Struktur =====
            cardFront.innerHTML = `
                <div class="flex justify-between items-center w-full mb-2 px-1 h-9 sm:h-10"> <h3 class="text-base sm:text-lg font-bold text-amber-800 truncate text-left mr-2">${cardName}</h3> ${headerRightContent} </div>
                ${attributeHTML} `;
            // ===== ENDE NEU =====

            const cardBack = document.createElement('div');
            cardBack.className = 'card-back rounded-xl shadow-lg border-2 border-amber-300 flex items-center justify-center relative overflow-hidden';

            card.appendChild(cardFront);
            card.appendChild(cardBack);
            return card;
        }
