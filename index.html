<!DOCTYPE html>
<html lang="de">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Holz-Quartett</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
Â  Â  Â  Â Â 
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
Â  Â  Â  Â  Â  Â  font-weight: 300;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-3d {
Â  Â  Â  Â  Â  Â  transform-style: preserve-3d;
Â  Â  Â  Â  Â  Â  transition: transform 0.6s;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-flipped {
Â  Â  Â  Â  Â  Â  transform: rotateY(180deg);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-front, .card-back {
Â  Â  Â  Â  Â  Â  backface-visibility: hidden;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-back {
Â  Â  Â  Â  Â  Â  transform: rotateY(180deg);
Â  Â  Â  Â  Â  Â  background-image: url('https://raw.githubusercontent.com/aufdemholzweg/holzquartett/65fd843a4db1ee434faaf81a32f77951a5afb72a/images/background_card.jpg');
Â  Â  Â  Â  Â  Â  background-size: cover;
Â  Â  Â  Â  Â  Â  background-position: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .wood-texture {
Â  Â  Â  Â  Â  Â  background: linear-gradient(45deg, #8B4513 25%, transparent 25%),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(-45deg, #8B4513 25%, transparent 25%),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(45deg, transparent 75%, #8B4513 75%),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(-45deg, transparent 75%, #8B4513 75%);
Â  Â  Â  Â  Â  Â  background-size: 20px 20px;
Â  Â  Â  Â  Â  Â  background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
Â  Â  Â  Â  Â  Â  background-color: #D2B48C;
Â  Â  Â  Â  Â  Â  opacity: 0.1;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .animate-pop-in {
Â  Â  Â  Â  Â  Â  animation: pop-in 0.5s ease-out forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  .animate-glow-win {
Â  Â  Â  Â  Â  Â  animation: glow-win 1.2s ease-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  .animate-glow-lose {
Â  Â  Â  Â  Â  Â  animation: glow-lose 1.2s ease-out;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @keyframes pop-in {
Â  Â  Â  Â  Â  Â  0% { transform: scale(0); opacity: 0; }
Â  Â  Â  Â  Â  Â  70% { transform: scale(1.2); opacity: 1; }
Â  Â  Â  Â  Â  Â  100% { transform: scale(1); }
Â  _ Â  Â  }

Â  Â  Â  Â  @keyframes glow-win {
Â  Â  Â  Â  Â  Â  0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); } /* green-400 */
Â  Â  Â  Â  Â  Â  50% { box-shadow: 0 0 30px 15px rgba(74, 222, 128, 0.6); }
Â  Â  Â  Â  Â  Â  100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes glow-lose {
Â  Â  Â  Â  Â  Â  0% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); } /* red-400 */
Â  Â  Â  Â  Â  Â  50% { box-shadow: 0 0 30px 15px rgba(248, 113, 113, 0.6); }
Â  Â  Â  Â  Â  Â  100% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .hover-lift:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-4px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
Â  Â  Â  Â  }

Â  Â  Â  Â  .status-flash-win {
Â  Â  Â  Â  Â  Â  animation: flash-green 1.2s ease-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .status-flash-lose {
Â  Â  Â  Â  Â  Â  animation: flash-red 1.2s ease-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes flash-green {
Â  Â  Â  Â  Â  50% { background-color: #22c55e; box-shadow: 0 0 15px #22c55e; }
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes flash-red {
Â  Â  Â  Â  Â  50% { background-color: #ef4444; box-shadow: 0 0 15px #ef4444; }
Â  Â  Â  Â  }

Â  Â  Â  Â  .falling-star {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  font-size: 7rem; /* 112px */
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  Â  Â  animation: fall-and-fade 1.2s ease-in forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes fall-and-fade {
Â  Â  Â  Â  Â  Â  0% { transform: translateY(-30px) scale(1.5); opacity: 0; }
Â  Â  Â  Â  Â  Â  30% { transform: translateY(0) scale(1); opacity: 1; }
Â  Â  Â  Â  Â  Â  100% { transform: translateY(var(--end-y)) scale(0.3); opacity: 0; }
Â  Â  Â  Â  }
Â  Â  Â  Â  .card-background {
Â  Â  Â  Â  Â  Â  background-image: url('https://raw.githubusercontent.com/aufdemholzweg/holzquartett/e7cfc18394e2e7f2d0b91df1138b0d7bc7930699/images/background_front.jpg');
Â  Â  Â  Â  Â  Â  background-size: cover;
Â  Â  Â  Â  Â  Â  background-position: center;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen">
Â  Â  Â  Â  <header class="bg-white shadow-sm border-b-2 border-amber-200">
Â  Â  Â  Â  <div class="max-w-6xl mx-auto px-4 p-3">
Â  Â  Â  Â  Â  Â  <h1 class="text-2xl font-bold text-amber-800 text-center">ğŸŒ³ Holz-Quartett</h1>
Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500 text-center mt-1">von Christopher Lehr, in Verbindung mit meiner Masterarbeit</p>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  Â  Â  <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
Â  Â  Â  Â  <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl text-center">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-amber-800 mb-6">Spielmodus wÃ¤hlen</h2>
Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.showNamePrompt('ai')" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ® Gegen Computer spielen
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.showNamePrompt('multiplayer')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ§‘â€ğŸ¤â€ğŸ§‘ Mit Freund online spielen
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="nameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
Â  Â  Â  Â  <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-amber-800 mb-6 text-center">Dein Name</h2>
Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-700 mb-2">Bitte gib deinen Namen ein:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="playerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="Spielername">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="nameSubmitButton" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Weiter
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="multiplayerLobbyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
Â  Â  Â  Â  <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl text-center">
Â  Â  Â  Â  Â  Â  <h2 id="lobbyTitle" class="text-2xl font-bold text-amber-800 mb-4">Warte auf Mitspieler...</h2>
Â  Â  Â  Â  Â  Â  <p id="lobbyText" class="text-gray-700 mb-6">Teile diesen Link mit deinem Freund, um das Spiel zu starten:</p>
Â  Â  Â  Â  Â  Â  <div class="bg-gray-100 p-3 rounded-lg border border-gray-300">
Â  Â  Â  Â  Â  Â  Â  Â  <input id="shareLink" type="text" class="w-full bg-transparent text-center text-blue-600" readonly>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button onclick="window.copyShareLink()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Link kopieren
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <p id="lobbyStatus" class="mt-6 text-green-600 font-semibold"></p>
Â  Â  Â  Â  </div>
Â  Â  </div>


Â  Â  Â  Â  <div id="gameContainer" class="hidden max-w-6xl mx-auto px-4 py-4 relative">
Â  Â  Â  Â  <div id="animationContainer" class="absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-md mx-auto mb-3 space-y-1">
Â  Â  Â  Â  Â  Â  <div class="flex justify-center space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="playerScoreBox" class="w-1/2 bg-white rounded-xl shadow-lg p-2 text-center relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="playerNameDisplay" class="text-base font-bold text-amber-600 truncate"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500">Karten: <span id="playerCards" class="font-semibold">15</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-1/2 bg-white rounded-xl shadow-lg p-2 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="opponentNameDisplay" class="text-base font-bold text-red-600">Computer</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500">Karten: <span id="aiCards" class="font-semibold">15</span></p>
Ã¡ Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden border border-gray-300">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="statusBar" class="h-full rounded-l-full transition-all duration-500" style="width: 50%; background-color: #f59e0b;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute inset-0 flex justify-center items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-0.5 h-full bg-white opacity-75"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center space-x-2 sm:space-x-2 mb-4 max-w-md mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center w-1/2">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="playerCard" class="relative aspect-[20/38] perspective-1000"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center w-1/2">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="aiCard" class="relative aspect-[20/38] perspective-1000"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-xl shadow-lg p-1 mt-4 text-center mx-auto flex flex-col items-center justify-center max-w-md w-full">
Â  Â  Â  Â  Â  Â  <div id="turnIndicator" class="hidden text-sm font-semibold p-2"></div>
Â  Â  Â  Â  Â  Â  <div id="attributeSelection" class="">
Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="text-lg font-semibold text-gray-700">WÃ¤hle eine Eigenschaft!</h3>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="nextRoundButton" class="hidden w-full mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â <button onclick="window.nextRound()" class="w-full bg-amber-600 hover:bg-amber-800 text-white font-bold py-3 px-8 rounded-xl transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â â¡ï¸ NÃ¤chster Zug
Â  Â  Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  <div id="resultDisplay" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 id="resultText" class="text-xl font-bold mb-1"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â <p id="resultDetails" class="text-sm text-gray-600"></p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="reflectionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
Â  Â  Â  Â  <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl text-center">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-amber-800 mb-4">ğŸ‰ Super gespielt! Zeit zum Reflektieren!</h2>
Â  Â  Â  Â  Â  Â  <p id="reflectionQuestion" class="text-gray-700 mb-6 text-left"></p>
Â  Â  Â  Â  Â  Â  <textarea id="reflectionAnswer" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent min-h-[100px]" placeholder="Deine BegrÃ¼ndung..."></textarea>
Â  Â  Â  Â  Â  Â  <button onclick="window.showFinalWinScreen()" class="mt-6 w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Weiter zum Ergebnis
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="gameOverModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
Â  Â  Â  Â  <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl text-center">
Â  Â  Â  Â  Â  Â  <h2 id="gameOverTitle" class="text-3xl font-bold mb-3"></h2>
Â  Â  Â  Â  Â  Â  <p id="gameOverText" class="text-gray-600 mb-6"></p>
Â  Â  Â  Â  Â  Â  <div class="space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.showLeaderboard()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ† Bestenliste anzeigen
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.resetGame()" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ”„ Neues Spiel
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="leaderboardModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
S Â  Â  <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-amber-800 mb-6 text-center">ğŸ† Bestenliste</h2>
Â  Â  Â  Â  Â  Â  <div id="leaderboardList" class="space-y-1 mb-6"></div>
Â  Â  Â  Â  Â  Â  <button onclick="window.closeLeaderboard()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  SchlieÃŸen
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="infoModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 px-4">
Â  Â  Â  Â  <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl relative">
Â  Â  Â  Â  Â  Â  <button onclick="window.closeInfoModal()" class="absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-600">&times;</button>
Â  Â  Â  Â  Â  Â  <h2 id="infoModalTitle" class="text-2xl font-bold text-amber-800 mb-4">Wissenswertes</h2>
Â  Â  Â  Â  Â  Â  <div id="infoModalContent" class="text-gray-700 space-y-2 max-h-[60vh] overflow-y-auto"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  // ===== Firebase Imports =====
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, serverTimestamp, deleteDoc, collection, query, orderBy, limit, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

Â  Â  Â  Â  // ===== Firebase Config =====
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyCyRXl8-JPr1xTXPDi1VG-eQk6fOnTpqUI",
Â  Â  Â  Â  Â  Â  authDomain: "holzquartett-3a177.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "holzquartett-3a177",
Â  Â  Â  Â  Â  Â  storageBucket: "holzquartett-3a177.appspot.com",
Â  Â  Â  Â  Â  Â  messagingSenderId: "1081595025073",
Â  Â  Â  Â  Â  Â  appId: "1:1081595025073:web:bc571fffb6e4f20b27f490",
Â  Â  Â  Â  Â  Â  measurementId: "G-HKLWFJE83K"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getFirestore(app);
Â  Â  Â  Â  const auth = getAuth(app);
Â  Â  Â  Â  const appId = firebaseConfig.projectId;

Â  Â  Â  Â  // ===== Global State =====
Â  Â  Â  Â  let gameMode = null;
Â  Â  Â  Â  let gameId = null;
Â  Â  Â  Â  let localPlayerId = null;
Â  Â  Â  Â  let unsubscribeGame = null;Â 
Â  Â  Â  Â  let localGameState = {};
Â  Â  Â  Â  let hasCopiedShareLink = false;

Â  Â  Â  Â  // NEU: Sound-Effekte
Â  Â  Â  Â  const sounds = {
Â  Â  Â  Â  Â  Â  flip: new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_139083c224.mp3'),
Â  Â  Â  Â  Â  Â  win: new Audio('https://cdn.pixabay.com/audio/2022/11/22/audio_2c5552a862.mp3')
Â  Â  Â  Â  };
        // Setze die LautstÃ¤rke (optional)
        sounds.flip.volume = 0.5;
        sounds.win.volume = 0.4;

Â  Â  Â  Â  function playSound(sound) {
Â  Â  Â  Â  Â  Â  sound.currentTime = 0; // Sound von vorne abspielen
Â  Â  Â  Â  Â  Â  sound.play().catch(e => console.log("Sound-Fehler:", e));
Â  Â  Â  Â  }
Â  Â  Â  Â  // NEU: Flag fÃ¼r Multiplayer-Sounds, um Spam zu verhindern
Â  Â  Â  Â  let roundSoundPlayed = false;
Â  Â  Â  Â  // ENDE NEU

Â  Â  Â  Â  // ===== Wood Data =====
Â  Â  Â  Â  const woodCards = [
Â  Â  Â  Â  Â  Â  {name: "Eiche", dk: 2, haerte: 85, quellenSchwindenRadial: 4.0, dichte: 650, gewicht: 12000}, {name: "Buche", dk: 5, haerte: 80, quellenSchwindenRadial: 5.8, dichte: 720, gewicht: 14000}, {name: "Kiefer", dk: 3, haerte: 40, quellenSchwindenRadial: 3.5, dichte: 520, gewicht: 11000}, {name: "Fichte", dk: 4, haerte: 35, quellenSchwindenRadial: 3.6, dichte: 450, gewicht: 11000}, {name: "Tanne", dk: 4, haerte: 38, quellenSchwindenRadial: 3.5, dichte: 460, gewicht: 10000}, {name: "LÃ¤rche", dk: 3, haerte: 55, quellenSchwindenRadial: 3.7, dichte: 590, gewicht: 12000}, {name: "Birke", dk: 5, haerte: 60, quellenSchwindenRadial: 5.4, dichte: 650, gewicht: 13000}, {name: "Ahorn", dk: 5, haerte: 75, quellenSchwindenRadial: 4.8, dichte: 630, gewicht: 12500}, {name: "Esche", dk: 5, haerte: 90, quellenSchwindenRadial: 4.9, dichte: 700, gewicht: 13000}, {name: "Kirsche", dk: 3, haerte: 70, quellenSchwindenRadial: 4.0, dichte: 600, gewicht: 11500}, {name: "Nussbaum", dk: 3, haerte: 65, quellenSchwindenRadial: 4.0, dichte: 640, gewicht: 12000}, {name: "Douglasie", dk: 3, haerte: 45, quellenSchwindenRadial: 3.5, dichte: 510, gewicht: 12000}, {name: "Zeder", dk: 2, haerte: 42, quellenSchwindenRadial: 2.8, dichte: 480, gewicht: 9500}, {name: "Mahagoni", dk: 2, haerte: 55, quellenSchwindenRadial: 3.0, dichte: 550, gewicht: 10500}, {name: "Teak", dk: 1, haerte: 60, quellenSchwindenRadial: 2.5, dichte: 650, gewicht: 11000}, {name: "Bambus", dk: 4, haerte: 50, quellenSchwindenRadial: 3.0, dichte: 400, gewicht: 18000}, {name: "Pappel", dk: 5, haerte: 25, quellenSchwindenRadial: 4.5, dichte: 380, gewicht: 9000}, {name: "Weide", dk: 5, haerte: 30, quellenSchwindenRadial: 4.0, dichte: 420, gewicht: 8000}, {name: "Linde", dk: 5, haerte: 35, quellenSchwindenRadial: 3.8, dichte: 530, gewicht: 9000}, {name: "Ulme", dk: 3, haerte: 75, quellenSchwindenRadial: 4.5, dichte: 680, gewicht: 11500}, {name: "Kastanie", dk: 2, haerte: 50, quellenSchwindenRadial: 3.5, dichte: 600, gewicht: 10000}, {name: "Robinie", dk: 1, haerte: 80, quellenSchwindenRadial: 3.0, dichte: 730, gewicht: 15000}, {name: "Hemlock", dk: 4, haerte: 40, quellenSchwindenRadial: 3.6, dichte: 500, gewicht: 10000}, {name: "Zypresse", dk: 2, haerte: 48, quellenSchwindenRadial: 3.0, dichte: 520, gewicht: 9000}, {name: "Redwood", dk: 2, haerte: 35, quellenSchwindenRadial: 2.8, dichte: 400, gewicht: 8500}, {name: "Hickory", dk: 3, haerte: 95, quellenSchwindenRadial: 5.5, dichte: 750, gewicht: 14000}, {name: "Wenge", dk: 2, haerte: 88, quellenSchwindenRadial: 3.8, dichte: 880, gewicht: 16000}, {name: "Zebrano", dk: 3, haerte: 70, quellenSchwindenRadial: 4.0, dichte: 750, gewicht: 13000}, {name: "Palisander", dk: 2, haerte: 82, quellenSchwindenRadial: 3.0, dichte: 850, gewicht: 16000}, {name: "Ebenholz", dk: 1, haerte: 98, quellenSchwindenRadial: 3.2, dichte: 1200, gewicht: 16500}
Â  Â  Â  Â  ];

Â  Â  Â  Â  const woodInfo = {
Â  Â  Â  Â  Â  "Eiche": { info: `Eiche (QE) Die Eiche zÃ¤hlt zu den bedeutendsten heimischen LaubhÃ¶lzern Europas. Ihr Holz ist hart, schwer und sehr dauerhaft, was sie zu einem bevorzugten Werkstoff im Innenâ€‘ und AuÃŸenbereich macht. Besonders charakteristisch sind die hohen Gerbstoffanteile, die das Holz widerstandsfÃ¤hig gegen Pilze und SchÃ¤dlinge machen â€“ gleichzeitig kÃ¶nnen sie beim Kontakt mit Eisen zu VerfÃ¤rbungen fÃ¼hren. Eichenholz ist grobporig und zeigt einen deutlichen Ãœbergang zwischen FrÃ¼h- und SpÃ¤tholz, wodurch die Jahresringe klar sichtbar sind. Diese ausgeprÃ¤gte Maserung sorgt fÃ¼r eine markante, lebendige Optik. Verwendung: MÃ¶bel, FuÃŸbÃ¶den, Treppen, Fassdauben (z.â€¯B. fÃ¼r WeinfÃ¤sser), Schiffbau, Terrassen, BrÃ¼cken, Fachwerk. Funfact: Bereits in der Antike galt die Eiche als Symbol fÃ¼r StÃ¤rke und BestÃ¤ndigkeit â€“ sie ziert bis heute zahlreiche Wappen und MÃ¼nzen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/eiche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/eiche_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Buche": { info: `Buche (BU) Die Buche ist ein gleichmÃ¤ÃŸig strukturiertes Hartholz heimischer WÃ¤lder. Ihr Holz ist zÃ¤h, biegsam und relativ harzarm, wodurch es sich sehr gut fÃ¼r MÃ¶bel und Parkett eignet. Buchenholz ist ringporig mit mittelgroÃŸen Poren im FrÃ¼hholz und dichterem SpÃ¤tholz, sodass die ÃœbergÃ¤nge dezent sichtbar sind â€“ die Jahresringe sind gut erkennbar, aber nicht grob. Verwendung: MÃ¶bel, Parkett, Furniere, Sperrholz, Innenausbau. Funfact: Buchenholz war lange Zeit typisch fÃ¼rs Wagenrad â€“ wegen seiner Kombination aus ZÃ¤higkeit und ElastizitÃ¤t.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/buche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/buche_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Kiefer": { info: `Kiefer (KI) Kiefer ist ein weit verbreitetes Nadelholz mit markanter Jahresringstruktur. Es ist weich, harzhaltig und relativ leicht zu bearbeiten. Das Holz zeigt keine ausgeprÃ¤gten groÃŸen Poren wie LaubhÃ¶lzer, sondern eine eher gleichmÃ¤ÃŸige Zellstruktur â€“ Jahresringe und HarzkanÃ¤le sind sichtbar. Verwendung: Bauholz, DachstÃ¼hle, Innenausbau, MÃ¶bel, Paneele. Funfact: Kiefernharz wurde frÃ¼her als Klebstoff oder als Bestandteil von Salben und Dichtungsmaterialien verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kiefer_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kiefer_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Fichte": { info: `Fichte (FI) Fichte ist ein klassisches Bauholz mit guter Festigkeit bei geringem Gewicht. Es lÃ¤sst sich leicht bearbeiten und vielfach einsetzen. Das Holz weist eine feine Zellstruktur auf, ohne groÃŸe Poren â€“ Jahresringe sind erkennbar, aber nicht grob. Verwendung: Bauholz, Innenverkleidung, Dach, MÃ¶bel, Paneele. Funfact: In vielen Gebirgsregionen war Fichtenholz Ã¼ber Jahrhunderte hinweg der Standard fÃ¼r Dachkonstruktionen und SÃ¤gewerke.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/fichte_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/fichte_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Tanne": { info: `Tanne (TA) Tanne ist ein harzarmes, vergleichsweise feines Nadelholz, das oft als Alternative zur Fichte verwendet wird. Die Struktur Ã¤hnelt der Fichte: feine Fasern, dezente Jahresringe, keine ausgeprÃ¤gten Poren. Verwendung: Innenausbau, MÃ¶bel, Paneele, Bauholz. Funfact: Da Tanne weniger Harz enthÃ¤lt, ist sie angenehmer in RÃ¤umen einzusetzen, da sie weniger Geruch abgibt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/tanne_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/tanne_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "LÃ¤rche": { info: `LÃ¤rche (LA) LÃ¤rche ist bekannt fÃ¼r ihre natÃ¼rliche WitterungsbestÃ¤ndigkeit und schÃ¶ne Farbe. Sie kombiniert ElastizitÃ¤t mit Festigkeit. Das Holz zeigt ausgeprÃ¤gte Jahresringe und HarzkanÃ¤le â€“ die Struktur ist deutlich sichtbar. Verwendung: Fassadenholz, Fenster, Terrassen, AuÃŸenbau, MÃ¶bel. Funfact: LÃ¤rchenholz wird hÃ¤ufig ohne chemische Behandlung im AuÃŸenbereich eingesetzt und erhÃ¤lt mit der Zeit eine edle Vergrauung.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/laerche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/laerche_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Birke": { info: `Birke (BI) Birke ist ein helles, dekoratives Holz mit feiner, gleichmÃ¤ÃŸiger Struktur. Es Ã¼berzeugt durch gute Biegsamkeit. Das Holz ist zerstreutporig â€“ Poren sind fein verteilt, ohne groÃŸe Unterschiede zwischen FrÃ¼h- und SpÃ¤tholz. Verwendung: MÃ¶bel, Furniere, Sperrholz, Innenausbau. Funfact: Birkenrinde wurde frÃ¼her als wasserabweisendes Material fÃ¼r BehÃ¤lter und Boote genutzt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/birke_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/birke_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Ahorn": { info: `Ahorn (AM) Ahorn ist hart, hell und elegant â€“ ideal fÃ¼r feine MÃ¶bel, Instrumente und Designanwendungen. Es handelt sich ebenfalls um ein zerstreutporiges Holz mit gleichmÃ¤ÃŸiger Porenverteilung, ohne starke ÃœbergÃ¤nge zwischen FrÃ¼hâ€‘ und SpÃ¤tholz. Verwendung: MÃ¶bel, Parkett, Instrumente, Schneidebretter. Funfact: Aus Ahorn gewinnt man auch Ahornsirup â€“ allerdings aus nordamerikanischen Arten, nicht unbedingt jene zum MÃ¶belbau.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ahorn_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ahorn_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Esche": { info: `Esche (ES) Die Esche ist ein besonders zÃ¤hes, elastisches Holz mit hoher Festigkeit. Sie zeigt ringporige Struktur mit deutlich sichtbaren Poren im FrÃ¼hholz und schmaleren Poren im SpÃ¤tholz. Verwendung: Werkzeugstiele, SportgerÃ¤te, MÃ¶bel, Parkett, Innenausbau. Funfact: In der Antike wurden WagenrÃ¤der und Speichen hÃ¤ufig aus Esche gefertigt â€“ wegen ihrer elastischen Eigenschaften.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/esche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/esche_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Kirsche": { info: `Kirsche (KR) Kirschbaumholz besitzt warme rote TÃ¶ne, die mit Licht nachdunkeln, und eine edle Struktur. Ringporig mit deutlichem Ãœbergang zwischen FrÃ¼h- und SpÃ¤tholz â€“ Jahresringe sind gut sichtbar. Verwendung: MÃ¶bel, Furniere, Innenausbau, Dekor. Funfact: Kirschholz wird oft in MÃ¶beln verwendet, die mit der Zeit â€œreiferâ€ aussehen â€“ die Farbe verbessert sich mit Alterung.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kirsche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kirsche_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Nussbaum": { info: `Nussbaum (NU) Nussbaumholz ist dunkel, dekorativ und sehr hochwertig. Das Kernholz hat oft starken Farbkontrast zum Splintholz. Es ist zerstreutporig â€“ Poren sind fein Ã¼ber die FlÃ¤che verteilt, oft mit dekorativen Maserungen. Verwendung: MÃ¶bel, Furniere, Intarsien, edle Ausstattungen. Funfact: Walnuss (Nussbaum) war schon in der Renaissance sehr geschÃ¤tzt und zierte viele kÃ¶nigliche MÃ¶belstÃ¼cke.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/nussbaum_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/nussbaum_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Douglasie": { info: `Douglasie (DO) Douglasienholz ist robust, witterungsbestÃ¤ndig und hÃ¤ufig im AuÃŸenbau eingesetzt. Die Struktur ist klar erkennbar â€“ deutliche Jahresringe mit Transition zwischen FrÃ¼hâ€‘ und SpÃ¤tholz. Verwendung: Bauholz, Fassaden, Dach, MÃ¶bel im AuÃŸenbereich. Funfact: Die Douglasie stammt ursprÃ¼nglich aus Nordamerika, ist aber auch in Europa weit verbreitet und wird groÃŸgezogen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/douglasie_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/douglasie_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Zeder": { info: `Zeder (ZE) Zedernholz duftet angenehm und besitzt von Natur aus eine Resistenz gegen Insektenbefall und Feuchtigkeit. Die Struktur ist fein mit gleichmÃ¤ÃŸigen Poren â€“ kein starker Kontrast zwischen FrÃ¼h- und SpÃ¤tholz. Verwendung: MÃ¶bel, Fassaden, Innenraum, SchrÃ¤nke. Funfact: Zedernholz wird oft in KleiderschrÃ¤nken eingesetzt, weil es den unverwechselbaren Duft und Insektenabwehr besitzt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zeder_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zeder_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Mahagoni": { info: `Mahagoni (MA) Mahagoni ist ein tropisches Edelholz mit hoher Dauerhaftigkeit und edler Farbe. Es ist zerstreutporig â€“ Poren gleichmÃ¤ÃŸig verteilt und oft mit dekorativer Kernholzstruktur. Verwendung: MÃ¶bel, Fenster, Luxusausstattung, Bootsbau. Funfact: In manchen LÃ¤ndern ist Mahagoni wegen seiner Seltenheit streng reguliert und unterliegt Artenschutzbestimmungen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/mahagoni_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/mahagoni_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Teak": { info: `Teak (TE) Teak ist extrem witterungsbestÃ¤ndig durch hohen Ã–l- und Harzgehalt â€“ ideal fÃ¼r AuÃŸenmÃ¶bel und Schiffsbau. Die Struktur ist fein zerstreutporig, mit dekorativem Erscheinungsbild und gleichmÃ¤ÃŸiger Porenverteilung. Verwendung: GartenmÃ¶bel, Terrassen, Boote, Fenster, AuÃŸenbereich. Funfact: Teakholz war frÃ¼her fÃ¼r den Bau von Kriegsschiffen sehr gefragt wegen seiner Dauerhaftigkeit und WasserbestÃ¤ndigkeit.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/teak_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/teak_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Bambus": { info: `Bambus (BA) Bambus ist botanisch gesehen kein Holz, sondern ein Gras â€“ dennoch extrem stabil und vielseitig verwendbar. Die Struktur ist rÃ¶hrenartig und weist keine klassischen Poren wie HarthÃ¶lzer auf. Verwendung: FuÃŸbÃ¶den, MÃ¶bel, Treppen, nachhaltiger Bau. Funfact: Bambus wÃ¤chst so schnell, dass einzelne Stangen innerhalb weniger Monate Ã¼ber einen Meter wachsen kÃ¶nnen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/bambus_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/bambus_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Pappel": { info: `Pappel (PA) Pappelholz ist sehr leicht und weich â€“ weniger tragfÃ¤hig, aber gut bearbeitbar. Feine Struktur, fast keine groÃŸen Poren â€“ Jahresringe nur dezent sichtbar. Verwendung: Leichtbau, Verpackungen, MÃ¶bel mit geringer Belastung. Funfact: Pappelholz wird oft fÃ¼r Modellbau oder FlugzeuginnenrÃ¤ume verwendet, wo Leichtigkeit zÃ¤hlt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/pappel_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/pappel_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Weide": { info: `Weide (WE) Weidenholz ist elastisch und biegsam â€“ traditionell fÃ¼r Flechtarbeiten und KÃ¶rbe verwendet. Die Struktur ist fein zerstreutporig, Poren kaum markant. Verwendung: Flechtwerk, Gartenbau, leichte MÃ¶bel. Funfact: Weidenruten werden seit Jahrhunderten fÃ¼r Korbgeflechte, ZÃ¤une und Rankhilfen genutzt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/weide_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/weide_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Linde": { info: `Linde (LI) Lindenholz ist weich, homogen und gut schnitzbar â€“ ideal fÃ¼r feine Holzarbeiten. Fein zerstreutporig und gleichmÃ¤ÃŸig, ohne groÃŸen Porenkontrast. Verwendung: Intarsien, geschnitzte Dekors, MÃ¶bel, Modellbau. Funfact: Lindenholz war traditionell das Holz der Bildhauer und Orgelbauer im Mittelalter.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/linde_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/linde_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Ulme": { info: `Ulme (UL) Ulmenholz ist zÃ¤h und eher hart â€“ frÃ¼her oft fÃ¼r MÃ¶bel und Reparaturen verwendet. Ringporig mit markanten Poren und gelegentlichem unruhigem Faserverlauf. Verwendung: MÃ¶bel, Innenausbau, Reparaturholz. Funfact: Ulmenholz hat frÃ¼her im Wagen- und MÃ¶belbau Bedeutung gehabt, besonders dort, wo Biegung gefragt war.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ulme_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ulme_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Kastanie": { info: `Kastanie (KA) Kastanienholz ist Ã¤hnlich der Eiche wetterbestÃ¤ndig, mit warmem Farbton und markanter Struktur. Ringporig mit klar sichtbaren Jahresringen und deutlichem Ãœbergang. Verwendung: AuÃŸenbau, MÃ¶bel, Balken, Gartenholz. Funfact: Kastanienholz wurde oft in historischen Bauwerken als wetterbestÃ¤ndige Alternative zur Eiche verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kastanie_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kastanie_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Robinie": { info: `Robinie (RO) Robinienholz ist eines der hÃ¤rtesten europÃ¤ischen HÃ¶lzer und sehr dauerhaft im Freien. Ringporig mit feinen Poren und schmalem Ãœbergang â€“ die Struktur ist weniger kontrastreich. Verwendung: Gartenholz, Terrassen, Balken, ZÃ¤une. Funfact: Robinie wird oft als â€europÃ¤isches Teakâ€œ genannt, weil es Ã¤hnliche Eigenschaften wie Tropenholz zeigt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/robinie_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/robinie_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Hemlock": { info: `Hemlock (HE) Hemlock ist ein nÃ¶rdliches Nadelholz mit feiner Struktur, weich und gleichmÃ¤ÃŸig. Die Porenstruktur Ã¤hnelt einfacher Zellstruktur; Jahresringe dezent sichtbar. Verwendung: Innenausbau, Paneele, Bauholz. Funfact: Hemlock wird oft im MÃ¶bel- und Leichtbau verwendet, wenn gutes VerhÃ¤ltnis zwischen Gewicht und StabilitÃ¤t gefragt ist.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hemlock_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hemlock_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Zypresse": { info: `Zypresse (ZY) Zypressenholz duftet gut und ist natÃ¼rlich resistent gegen Feuchtigkeit und SchÃ¤dlinge. Die Struktur ist fein und gleichmÃ¤ÃŸig, mit moderatem Porencharakter. Verwendung: AuÃŸen- und Gartenholz, MÃ¶bel, Fassaden. Funfact: Zypresse wurde in mediterranen Regionen oft zur Holzverkleidung von Kirchen und Tempeln verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zypresse_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zypresse_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Redwood": { info: `Redwood (RW) Redwood ist ein leichtes Tropenholz mit guter Dauerhaftigkeit und dekorativer Farbe. Zerstreutporig mit feiner Textur, Poren gleichmÃ¤ÃŸig verteilt. Verwendung: AuÃŸenholz, ZÃ¤une, Gartenkonstruktionen. Funfact: Der KÃ¼stenmammutbaum (Redwood) zÃ¤hlt zu den hÃ¶chsten BÃ¤umen der Welt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/redwood_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/redwood_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Hickory": { info: `Hickory (HI) Hickory ist ein ausgesprochen zÃ¤hes und hartes Holz â€“ ideal fÃ¼r stark beanspruchte Teile. Ringporig mit ausgeprÃ¤gten Poren im FrÃ¼hholz und klaren Jahresringen. Verwendung: Werkzeugstiele, SportgerÃ¤te, MÃ¶bel mit hoher Belastung. Funfact: Hickory war traditionell Material fÃ¼r Peitschen, WurfstÃ¶cke und ArbeitsgerÃ¤te.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hickory_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hickory_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Wenge": { info: `Wenge (WE-NE) Wenge ist ein dunkles Tropenholz mit hoher HÃ¤rte und dekorativer Maserung. Zerstreutporig mit feinen Poren â€“ oft Streifenzeichnung sichtbar. Verwendung: LuxusmÃ¶bel, Parkett, Furniere. Funfact: Wegen seiner tiefen, dunklen Farbe wird Wenge oft in Kontrasten zu hellem Holz kombiniert.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/wenge_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/wenge_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Zebrano": { info: `Zebrano (ZE-RA) Zebrano zeichnet sich durch seine markante Streifenoptik aus â€“ dekorativ und auffÃ¤llig. Die Porenstruktur ist zerstreutporig, oft mit deutlichem Maserungseffekt. Verwendung: DesignmÃ¶bel, Furniere, Dekorationen. Funfact: Zebrano wird oft fÃ¼r luxuriÃ¶se Intarsien und Furnierarbeiten verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zebrano_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zebrano_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Palisander": { info: `Palisander (PA) Palisanderholz ist dekorativ, fest und langlebig â€“ mit attraktiven FarbtÃ¶nen. Zerstreutporig mit feiner Struktur und gleichmÃ¤ÃŸiger Porenverteilung. Verwendung: Gitarren, MÃ¶bel, Furniere. Funfact: Palisanderholz war frÃ¼her oft exklusiv fÃ¼r edle Musikinstrumente und Intarsien reserviert.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/palisander_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/palisander_2.jpg?raw=true" },
Â  Â  Â  Â  Â  "Ebenholz": { info: `Ebenholz (EB) Ebenholz ist eines der hÃ¤rtesten HÃ¶lzer â€“ fast tiefschwarz und sehr dicht. Zerstreutporig mit extrem feinen Poren, kaum sichtbar â€“ Porenstruktur sehr fein. Verwendung: Klaviertasten, Intarsien, Luxusdekore. Funfact: Ebenholz wurde im alten Ã„gypten fÃ¼r Statuetten und SchmuckstÃ¼cke verwendet â€“ wegen seiner tiefen Farbe und Seltenheit.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ebenholz_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ebenholz_2.jpg?raw=true" }
Â  Â  Â  Â  };

Â  Â  Â  Â  const reflectionQuestions = [
Â  Â  Â  Â  Â  Â  "Stell dir vor, du sollst einen stabilen und langlebigen Esstisch fÃ¼r eine Familie entwerfen. ...", "Welches Holz wÃ¼rdest du fÃ¼r GartenmÃ¶bel wÃ¤hlen, ...", "Eine KÃ¼chenarbeitsplatte muss schnittfest und widerstandsfÃ¤hig sein. ...", "FÃ¼r einen stark beanspruchten Dielenboden ...", "Du sollst den Korpus einer Akustikgitarre bauen. ...", "Fenster sind stÃ¤ndig wechselnder Luftfeuchtigkeit ausgesetzt. ...", "FÃ¼r ein Modellflugzeug oder ein leichtes Regal ...", "Robinie und LÃ¤rche sind beide fÃ¼r den AuÃŸenbereich beliebt. ...", "Du mÃ¶chtest einen gebogenen Handlauf ...", "Vergleiche die Rohdichte und den E-Modul von Fichte und Eiche. ...", "HÃ¶lzer mit hohem Quell- und SchwindmaÃŸ ...", "Ein Hammerstiel muss extrem bruchfest ...", "Bei Eichenholz kann es in Verbindung mit Eisen ...", "Weiche HÃ¶lzer wie Fichte oder Kiefer ...", "FÃ¼r die Herstellung von dekorativen Furnieren ...", "Nenne drei heimische HÃ¶lzer ...", "Holz ist ein wichtiger COâ‚‚-Speicher. ...", "Was bedeuten Siegel wie FSC oder PEFC ...", "Teak hat eine exzellente Dauerhaftigkeit (DK 1). ...", "Bambus ist botanisch gesehen ein Gras, ...", "Was kÃ¶nntest du aus einem alten Eichenbalken ...", "Du mÃ¶chtest ein MÃ¶belstÃ¼ck mit einem starken Hell-Dunkel-Kontrast ...", "HÃ¶lzer wie Eiche oder Esche haben ...", "Stell dir vor, du entwirfst ein Kinderspielzeug ...", "Einige HÃ¶lzer wie Kirsche oder LÃ¤rche ...", "FÃ¼r ein modernes, minimalistisches MÃ¶belstÃ¼ck ...", "Welches Holz wÃ¼rdest du fÃ¼r den Bau einer rustikalen AlmhÃ¼tte ...", "Du planst ein SchÃ¼lerprojekt ...", "Ein Kunde wÃ¼nscht sich fÃ¼r seine Terrasse ...", "Welche Eigenschaft einer Holzart ...", "Wenn du eine neue Kategorie ...",
Â  Â  Â  Â  ];

Â  Â  Â  Â  const attributeInfo = {
Â  Â  Â  Â  Â  Â  dk: {icon: 'ğŸ›¡ï¸', name: 'Dauerhaftigkeit (DK)', color: 'blue'},
Â  Â  Â  Â  Â  Â  haerte: {icon: 'ğŸ’', name: 'Druckfestigkeit (N/mmÂ²)', color: 'blue'},
Â  Â  Â  Â  Â  Â  quellenSchwindenRadial: {icon: 'â†”ï¸', name: 'Quellen/Schwinden (%)', color: 'blue'},
Â  Â  Â  Â  Â  Â  dichte: {icon: 'âš–ï¸', name: 'Rohdichte (kg/mÂ³)', color: 'blue'},
Â  Â  Â  Â  Â  Â  gewicht: {icon: 'ğŸ‹ï¸', name: 'E-Modul (N/mmÂ²)', color: 'blue'}
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  let aiGame = { playerName: '', playerCards: [], aiCards: [], currentPlayerCard: null, currentAiCard: null, roundInProgress: false };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ===== Auth + Deep Link Join =====
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', async () => {
Â  Â  Â  Â  Â  Â  try { await signInAnonymously(auth); } catch (e) { console.error("Firebase Auth Error:", e); }
Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localPlayerId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const gameIdFromUrl = urlParams.get('game');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (gameIdFromUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameId = gameIdFromUrl;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameMode = 'multiplayer';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.showNamePrompt('join');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  window.addEventListener('beforeunload', async () => {
Â  Â  Â  Â  Â  Â  if (gameMode === 'multiplayer' && gameId && localPlayerId) {
Â  Â  Â  Â  Â  Â  Â  Â  const gameRef = doc(db, "games", gameId);
Â  Â  Â  Â  Â  Â  Â  Â  const playerStatusPath = `players.${localPlayerId}.status`;
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(gameRef, { [playerStatusPath]: "offline" }).catch(() => {});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // ===== UI Control =====
Â  Â  Â  Â  window.showNamePrompt = (mode) => {
Â  Â  Â  Â  Â  Â  document.getElementById('setupModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  const nameModal = document.getElementById('nameModal');
Â  Â  Â  Â  Â  Â  nameModal.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  const nameSubmitButton = document.getElementById('nameSubmitButton');
Â  Â  Â  Â  Â  Â  const newButton = nameSubmitButton.cloneNode(true);
Â  Â  Â  Â  Â  Â  nameSubmitButton.parentNode.replaceChild(newButton, nameSubmitButton);

Â  Â  Â  Â  Â  Â  newButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  const playerName = document.getElementById('playerName').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if (!playerName) { alert('Bitte gib deinen Namen ein!'); return; }
Â  Â  Â  Â  Â  Â  Â  Â  nameModal.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  if (mode === 'ai') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameMode = 'ai';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startGameAI(playerName);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (mode === 'multiplayer') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameMode = 'multiplayer';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createGame(playerName);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (mode === 'join') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  joinGame(gameId, playerName);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  window.copyShareLink = async () => {
Â  Â  Â  Â  Â  Â  const linkInput = document.getElementById('shareLink');
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await navigator.clipboard.writeText(linkInput.value);
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  linkInput.select();
Â  Â  Â  Â  Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  hasCopiedShareLink = true;
Â  Â  Â  Â  Â  Â  const statusEl = document.getElementById('lobbyStatus');
Â  Â  Â  Â  Â  Â  if (statusEl) statusEl.textContent = 'Link kopiert. Warte auf Mitspieler...';

Â  Â  Â  Â  Â  Â  if (localGameState && (localGameState.status === 'playing' || localGameState.status === 'finished')) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('multiplayerLobbyModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameContainer').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  updateMultiplayerUI(localGameState);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // ===== Multiplayer Logic =====
Â  Â  Â  Â  async function createGame(playerName) {
Â  Â  Â  Â  Â  Â  const lobbyModal = document.getElementById('multiplayerLobbyModal');
Â  Â  Â  Â  Â  Â  lobbyModal.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  hasCopiedShareLink = false;

Â  Â  Â  Â  Â  Â  gameId = Math.random().toString(36).substring(2, 8).toUpperCase();
Â  Â  Â  Â  Â  Â  const shareLinkInput = document.getElementById('shareLink');
Â  Â  Â  Â  Â  Â  const baseUrl = window.location.href.split('?')[0];
Â  Â  Â  Â  Â  Â  shareLinkInput.value = `${baseUrl}?game=${gameId}`;

Â  Â  Â  Â  Â  Â  const gameRef = doc(db, "games", gameId);
Â  Â  Â  Â  Â  Â  const initialGameData = {
Â  Â  Â  Â  Â  Â  Â  Â  gameId: gameId,
Â  Â  Â  Â  Â  Â  Â  Â  status: 'waiting',
Â  Â  Â  Â  Â  Â  Â  Â  playerIds: [localPlayerId],
Â  Â  Â  Â  Â  Â  Â  Â  players: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [localPlayerId]: { name: playerName, cards: [], status: 'online' }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  await setDoc(gameRef, initialGameData);
Â  Â  Â  Â  Â  Â  listenToGameChanges();
Â  Â  Â  Â  }

Â  Â  Â  Â  async function joinGame(gameIdToJoin, playerName) {
Â  Â  Â  Â  Â  Â  const gameRef = doc(db, "games", gameIdToJoin);
Â  Â  Â  Â  Â  Â  const gameSnap = await getDoc(gameRef);

Â  Â  Â  Â  Â  Â  if (gameSnap.exists() && gameSnap.data().status === 'waiting' && gameSnap.data().playerIds.length === 1) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('lobbyTitle').textContent = "Spiel wird beigetreten...";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('lobbyText').textContent = "Moment, die Karten werden gemischt.";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('multiplayerLobbyModal').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  hasCopiedShareLink = true;

Â  Â  Â  Â  Â  Â  Â  Â  const shuffledCards = shuffleArray(woodCards);
Â  Â  Â  Â  Â  Â  Â  Â  const player1Id = gameSnap.data().playerIds[0];

Â  Â  Â  Â  Â  Â  Â  Â  const gameUpdateData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'playing',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerIds: [player1Id, localPlayerId],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [`players.${localPlayerId}`]: { name: playerName, cards: shuffledCards.slice(15), status: 'online' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [`players.${player1Id}.cards`]: shuffledCards.slice(0, 15),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turn: player1Id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentCards: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [player1Id]: shuffledCards.slice(0, 15)[0],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [localPlayerId]: shuffledCards.slice(15)[0],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastResult: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastActivity: serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(gameRef, gameUpdateData);
Â  Â  Â  Â  Â  Â  Â  Â  listenToGameChanges();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Spiel nicht gefunden oder bereits voll.");
Â  Â  Â  Â  Â  Â  Â  Â  window.location.search = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function listenToGameChanges() {
Â  Â  Â  Â  Â  Â  const gameRef = doc(db, "games", gameId);
Â  Â  Â  Â  Â  Â  unsubscribeGame = onSnapshot(gameRef, (docSnap) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Das Spiel wurde beendet.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetGame();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const gameData = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  localGameState = gameData;

Â  Â  Â  Â  Â  Â  Â  Â  if (gameData.status === 'playing' || gameData.status === 'finished') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (hasCopiedShareLink) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('multiplayerLobbyModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameContainer').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateMultiplayerUI(gameData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const statusEl = document.getElementById('lobbyStatus');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (statusEl) statusEl.textContent = 'Mitspieler ist beigetreten. Klicke â€Link kopierenâ€œ, um fortzufahren.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const opponentId = gameData.playerIds.find(id => id !== localPlayerId);
Â  Â  Â  Â  Â  Â  Â  Â  if (opponentId && gameData.players[opponentId]?.status === 'offline') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // alert('Dein Mitspieler hat das Spiel verlassen.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateMultiplayerUI(gameData) {
Â  Â  Â  Â  Â  Â  const opponentId = gameData.playerIds.find(id => id !== localPlayerId);

Â  Â  Â  Â  Â  Â  document.getElementById('playerNameDisplay').textContent = gameData.players[localPlayerId].name;
Â  Â  Â  Â  Â  Â  document.getElementById('playerCards').textContent = gameData.players[localPlayerId].cards.length;

Â  Â  Â  Â  Â  Â  if (opponentId) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('opponentNameDisplay').textContent = gameData.players[opponentId].name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('aiCards').textContent = gameData.players[opponentId].cards.length;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('opponentNameDisplay').textContent = "Wartet...";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('aiCards').textContent = '...';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  updateStatusBar(gameData.players[localPlayerId].cards.length, gameData.players[opponentId]?.cards.length || 0);
Â  Â  Â  Â  Â  Â  displayMultiplayerCards(gameData);

Â  Â  Â  Â  Â  Â  const turnIndicator = document.getElementById('turnIndicator');
Â  Â  Â  Â  Â  Â  const attributeSelection = document.getElementById('attributeSelection');
Â  Â  Â  Â  Â  Â  const resultDisplay = document.getElementById('resultDisplay');
Â  Â  Â  Â  Â  Â  const nextRoundBtn = document.getElementById('nextRoundButton');

Â  Â  Â  Â  Â  Â  turnIndicator.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  if (gameData.lastResult) {
Â  Â  Â  Â  Â  Â  Â  Â  // NEU: Sounds fÃ¼r Runden-Ergebnis abspielen
Â  Â  Â  Â  Â  Â  Â  Â  if (!roundSoundPlayed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  roundSoundPlayed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playSound(sounds.flip); // Flip-Sound, wenn das Ergebnis feststeht
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { winnerId } = gameData.lastResult;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (winnerId === localPlayerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playSound(sounds.win); // Win-Sound, wenn man selbst gewonnen hat
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // ENDE NEU

Â  Â  Â  Â  Â  Â  Â  Â  attributeSelection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  resultDisplay.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  nextRoundBtn.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  const { winnerId, attribute, values } = gameData.lastResult;
Â  Â  Â  Â  Â  Â  Â  Â  const winnerName = winnerId === localPlayerId ? 'Du' : (winnerId === 'tie' ? '' : gameData.players[winnerId]?.name);

Â  Â  Â  Â  Â  Â  Â  Â  let resultText = winnerId === 'tie' ? `ğŸ¤ Unentschieden!` : `ğŸ‰ ${winnerName || 'Gegner'} gewinnt!`;
Â  Â  Â  Â  Â  Â  Â  Â  if (winnerId !== localPlayerId && winnerId !== 'tie') resultText = `ğŸ˜ ${winnerName} gewinnt!`;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('resultText').textContent = resultText;
Â  Â  Â  Â  Â  Â  Â  Â  const opponentId2 = gameData.playerIds.find(id => id !== localPlayerId);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('resultDetails').textContent = `${attributeInfo[attribute].name.split(' (')[0]}: ${values[localPlayerId]} vs ${values[opponentId2]}`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const playerCardFront = document.getElementById('playerCard').querySelector('.card-front');
Â  Â  Â  Â  Â  Â  Â  Â  const statusBar = document.getElementById('statusBar');

Â  Â  Â  Â  Â  Â  Â  Â  if (winnerId === localPlayerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (playerCardFront) playerCardFront.classList.add('animate-glow-win');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (statusBar) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBar.classList.add('status-flash-win');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => statusBar.classList.remove('status-flash-win'), 1200);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  triggerWinStarAnimation();
Â  Â  Â  Â  Â  Â  Â  Â  } else if (winnerId !== 'tie') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (playerCardFront) playerCardFront.classList.add('animate-glow-lose');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (statusBar) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBar.classList.add('status-flash-lose');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => statusBar.classList.remove('status-flash-lose'), 1200);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  roundSoundPlayed = false; // NEU: Sound-Flag fÃ¼r die nÃ¤chste Runde zurÃ¼cksetzen

Â  Â  Â  Â  Â  Â  Â  Â  resultDisplay.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  nextRoundBtn.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  if (gameData.turn === localPlayerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turnIndicator.textContent = "Du bist am Zug!";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turnIndicator.className = 'text-sm font-semibold p-2 text-green-600';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attributeSelection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turnIndicator.textContent = `${gameData.players[gameData.turn]?.name} ist am Zug...`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turnIndicator.className = 'text-sm font-semibold p-2 text-gray-500';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attributeSelection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateStatusBar(playerCount, opponentCount) {
Â  Â  Â  Â  Â  Â  const total = playerCount + opponentCount;
Â  Â  Â  Â  Â  Â  const playerPercentage = total > 0 ? (playerCount / total) * 100 : 50;

Â  Â  Â  Â  Â  Â  const statusBar = document.getElementById('statusBar');
Â  Â  Â  Â  Â  Â  if (statusBar) {
Â  Â  Â  Â  Â  Â  Â  Â  statusBar.style.width = `${playerPercentage}%`;
Â  Â  Â  Â  Â  Â  Â  Â  let color = '#f59e0b'; // amber-500
Â  Â  Â  Â  Â  Â  Â  Â  if (playerPercentage < 25) color = '#c2410c';
Â  Â  Â  Â  Â  Â  Â  Â  else if (playerPercentage < 50) color = '#f59e0b';
Â  Â  Â  Â  Â  Â  Â  Â  else if (playerPercentage > 75) color = '#16a34a';
Â  Â  Â  Â  Â  Â  Â  Â  else if (playerPercentage > 50) color = '#84cc16';
Â  Â  Â  Â  Â  Â  Â  Â  statusBar.style.backgroundColor = color;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function displayMultiplayerCards(gameData) {
Â  Â  Â  Â  Â  Â  const opponentId = gameData.playerIds.find(id => id !== localPlayerId);
Â  Â  Â  Â  Â  Â  const playerCardContainer = document.getElementById('playerCard');
Â  Â  Â  Â  Â  Â  const aiCardContainer = document.getElementById('aiCard');
Â  Â  Â  Â  Â  Â  playerCardContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  aiCardContainer.innerHTML = '';

Â  Â  Â  Â  Â  Â  const showOpponentCard = !!gameData.lastResult;

Â  Â  Â  Â  Â  Â  const playerCard = createCard(gameData.currentCards[localPlayerId], true, true);
Â  Â  Â  Â  Â  Â  playerCardContainer.appendChild(playerCard);

Â  Â  Â  Â  Â  Â  if (opponentId && gameData.currentCards[opponentId]) {
Â  Â  Â  Â  Â  Â  Â  Â  const aiCard = createCard(gameData.currentCards[opponentId], showOpponentCard, false);
Â  Â  Â  Â  Â  Â  Â  Â  aiCardContainer.appendChild(aiCard);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  aiCardContainer.innerHTML = `<div class="card-front bg-gray-200 rounded-xl shadow-md border-2 border-gray-300 p-3 flex flex-col items-center justify-center h-full">Wartet auf Spieler 2...</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function multiplayerSelectAttribute(attribute) {
Â  Â  Â  Â  Â  Â  if (!localGameState || localGameState.turn !== localPlayerId || localGameState.lastResult) return;

Â  Â  Â  Â  Â  Â  const playerCard = localGameState.currentCards[localPlayerId];
Â  Â  Â  Â  Â  Â  const opponentId = localGameState.playerIds.find(id => id !== localPlayerId);
Â  Â  Â  Â  Â  Â  const opponentCard = localGameState.currentCards[opponentId];

Â  Â  Â  Â  Â  Â  const playerValue = playerCard[attribute];
Â  Â  Â  Â  Â  Â  const opponentValue = opponentCard[attribute];

Â  Â  Â  Â  Â  Â  let playerWins;
Â  Â  Â  Â  Â  Â  if (attribute === 'quellenSchwindenRadial' || attribute === 'dk') {
Â  Â  Â  Â  Â  Â  Â  Â  if (playerValue < opponentValue) playerWins = true; else if (opponentValue < playerValue) playerWins = false; else playerWins = 'tie';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (playerValue > opponentValue) playerWins = true; else if (opponentValue > playerValue) playerWins = false; else playerWins = 'tie';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const winnerId = playerWins === 'tie' ? 'tie' : (playerWins ? localPlayerId : opponentId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const gameUpdate = {
Â  Â  Â  Â  Â  Â  Â  Â  lastResult: { winnerId, attribute, values: { [localPlayerId]: playerValue, [opponentId]: opponentValue } },
Â  Â  Â  Â  Â  Â  Â  Â  lastActivity: serverTimestamp()
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "games", gameId), gameUpdate);
Â  Â  Â  Â  }

Â  Â  Â  Â  async function multiplayerNextRound() {
Â  Â  Â  Â  Â  Â  const pf = document.getElementById('playerCard')?.querySelector('.card-front');
Â  Â  Â  Â  Â  Â  if(pf) pf.classList.remove('animate-glow-win', 'animate-glow-lose');
Â  Â  Â  Â  Â  Â  const af = document.getElementById('aiCard')?.querySelector('.card-front');
Â  Â  Â  Â  Â  Â  if(af) af.classList.remove('animate-glow-win', 'animate-glow-lose');

Â  Â  Â  Â  Â  Â  if (!localGameState || !localGameState.lastResult) return;
Â  Â  Â  Â  Â  Â  if (localGameState.turn !== localPlayerId && localGameState.lastResult.winnerId !== localPlayerId && localGameState.lastResult.winnerId !== 'tie') return;

Â  Â  Â  Â  Â  Â  const { winnerId } = localGameState.lastResult;
Â  Â  Â  Â  Â  Â  const [player1Id, player2Id] = localGameState.playerIds;

Â  Â  Â  Â  Â  Â  const p1Cards = [...localGameState.players[player1Id].cards];
Â  Â  Â  Â  Â  Â  const p2Cards = [...localGameState.players[player2Id].cards];

Â  Â  Â  Â  Â  Â  const p1Card = p1Cards.shift();
Â  Â  Â  Â  Â  Â  const p2Card = p2Cards.shift();

Â  Â  Â  Â  Â  Â  if (winnerId === player1Id) p1Cards.push(p1Card, p2Card);
Â  Â  Â  Â  Â  Â  else if (winnerId === player2Id) p2Cards.push(p1Card, p2Card);
Â  Â  Â  Â  Â  Â  else { p1Cards.push(p1Card); p2Cards.push(p2Card); }

Â  Â  Â  Â  Â  Â  if (p1Cards.length === 0 || p2Cards.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "games", gameId), { status: 'finished' });
Â  Â  Â  Â  Â  Â  Â  Â  endGame();Â 
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const nextTurn = winnerId === 'tie' ? localGameState.turn : winnerId;
Ã‚ Â  Â  Â  Â  Â  const gameUpdate = {
Â  Â  Â  Â  Â  Â  Â  Â  'lastResult': null, 'turn': nextTurn,
Â  Â  Â  Â  Â  Â  Â  Â  'players': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [player1Id]: { ...localGameState.players[player1Id], cards: p1Cards },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [player2Id]: { ...localGameState.players[player2Id], cards: p2Cards }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  'currentCards': { [player1Id]: p1Cards[0], [player2Id]: p2Cards[0] },
Â  Â  Â  Â  Â  Â  Â  Â  'lastActivity': serverTimestamp()
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "games", gameId), gameUpdate);
Â  Â  Â  Â  }

Â  Â  Â  Â  // ===== Controller for both modes =====
Â  Â  Â  Â  window.selectAttribute = function(attribute) {
Â  Â  Â  Â  Â  Â  if (gameMode === 'ai') {
Â  Â  Â  Â  Â  Â  Â  Â  selectAttributeAI(attribute);
Â  Â  Â  Â  Â  Â  } else if (gameMode === 'multiplayer') {
Â  Â  Â  Â  Â  Â  Â  Â  multiplayerSelectAttribute(attribute);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  window.nextRound = function() {
Â  Â  Â  Â  Â  Â  if (gameMode === 'ai') {
Â  Â  Â  Â  Â  Â  Â  Â  nextRoundAI();
Â  Â  Â  Â  Â  Â  } else if (gameMode === 'multiplayer') {
Â  Â  Â  Â  Â  Â  Â  Â  multiplayerNextRound();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // ===== AI Mode Logic =====
Â  Â  Â  Â  function shuffleArray(array) {
Â  Â  Â  Â  Â  Â  const shuffled = [...array];
Â  Â  Â  Â  Â  Â  for (let i = shuffled.length - 1; i > 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  Â  Â  Â  Â  Â  Â  [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return shuffled;
Â  Â  Â  Â  }

Â  Â  Â  Â  function startGameAI(playerName) {
Â  Â  Â  Â  Â  Â  aiGame.playerName = playerName;
Â  Â  Â  Â  Â  Â  document.getElementById('playerNameDisplay').textContent = playerName;
Â  Â  Â  Â  Â  Â  const shuffledCards = shuffleArray(woodCards);
Â  Â  Â  Â  Â  Â  aiGame.playerCards = shuffledCards.slice(0, 15);
Â  Â  Â  Â  Â  Â  aiGame.aiCards = shuffledCards.slice(15, 30);
Â  Â  Â  Â  Â  Â  aiGame.currentPlayerCard = aiGame.playerCards[0];
Â  Â  Â  Â  Â  Â  aiGame.currentAiCard = aiGame.aiCards[0];
Â  Â  Â  Â  Â  Â  document.getElementById('gameContainer').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  Â  Â  updateDisplayAI();
Â  Â  Â  Â  Â  Â  displayCardsAI();
Â  Â  Â  Â  }

Â  Â  Â  Â  function createCard(cardData, isRevealed = true, isPlayer = true) {
Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  card.className = `card-3d w-full h-full relative cursor-pointer transition-all duration-300 ${isPlayer ? 'hover-lift' : ''}`;
Â  Â  Â  Â  Â  Â  if (!isRevealed) card.classList.add('card-flipped');

Â  Â  Â  Â  Â  Â  const borderColor = isPlayer ? 'border-amber-400' : 'border-gray-300';
Â  Â  Â  Â  Â  Â  const shadow = isPlayer ? 'shadow-lg' : 'shadow-md';
Â  Â  Â  Â  Â  Â  const cardFront = document.createElement('div');
Â  Â  Â  Â  Â  Â  cardFront.className = `card-front card-background rounded-xl ${shadow} border-2 ${borderColor} p-3 flex flex-col`;

Â  Â  Â  Â  Â  Â  const canSelect = isPlayer && ( (gameMode === 'ai' && !aiGame.roundInProgress) || (gameMode === 'multiplayer' && localGameState.turn === localPlayerId && !localGameState.lastResult));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const isRoundOver = (gameMode === 'ai' && aiGame.roundInProgress) || (gameMode === 'multiplayer' && localGameState.lastResult);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const infoButtonHTML = isPlayer ? `
Â  Â  Â  Â  Â  Â  Â  Â  <button id="player-info-button-${cardData.name.replace(/\s+/g, '-')}" onclick="window.showWoodInfo('${cardData.name}')" class="${isRoundOver ? '' : 'hidden'} bg-purple-600 text-white rounded-full h-9 w-9 flex items-center justify-center text-lg hover:bg-purple-700 absolute top-2 left-2">ğŸ’¡</button>
Â  Â  Â  Â  Â  Â  ` : '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const woodData = woodInfo[cardData.name] || woodInfo[Object.keys(woodInfo).find(k => k.toLowerCase() === cardData.name.toLowerCase())];
Â  Â  Â  Â  Â  Â  const treeImage = woodData ? woodData.bildBaum : 'https://placehold.co/36x36/d1d5db/374151?text=?';

Â  Â  Â  Â  Â  Â  const woodIconHTML = `<img src="${treeImage}" alt="${cardData.name}" id="wood-image-icon-${cardData.name.replace(/\s+/g, '-')}" class="${isRoundOver && isPlayer ? 'hidden' : ''} w-9 h-9 object-cover rounded-full border-2 border-amber-200 flex-shrink-0 absolute top-2 left-2">`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const attributeButtons = canSelect ? `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1 mt-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.selectAttribute('dk')" class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 hover:bg-amber-200 rounded-xl transition-colors text-left border border-amber-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center"><span class="mr-2 text-xs">ğŸ›¡ï¸</span><div><span class="text-xs font-medium leading-tight">Dauerhaftigkeit</span><span class="block text-xs text-gray-500 leading-tight">(DK)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.dk}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.selectAttribute('haerte')" class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 hover:bg-amber-200 rounded-xl transition-colors text-left border border-amber-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center"><span class="mr-2 text-xs">ğŸ’</span><div><span class="text-xs font-medium leading-tight">Druckfestigkeit</span><span class="block text-xs text-gray-500 leading-tight">(N/mmÂ²)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.haerte}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.selectAttribute('quellenSchwindenRadial')" class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 hover:bg-amber-200 rounded-xl transition-colors text-left border border-amber-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center"><span class="mr-2 text-xs">â†”ï¸</span><div><span class="text-xs font-medium leading-tight">Quellen/Schw.</span><span class="block text-xs text-gray-500 leading-tight">(%)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.quellenSchwindenRadial}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.selectAttribute('dichte')" class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 hover:bg-amber-200 rounded-xl transition-colors text-left border border-amber-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center"><span class="mr-2 text-xs">âš–ï¸</span><div><span class="text-xs font-medium leading-tight">Rohdichte</span><span class="block text-xs text-gray-500 leading-tight">(kg/mÂ³)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.dichte}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.selectAttribute('gewicht')" class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 hover:bg-amber-200 rounded-xl transition-colors text-left border border-amber-600">
Ã‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center"><span class="mr-2 text-xs">ğŸ‹ï¸</span><div><span class="text-xs font-medium leading-tight">E-Modul</span><span class="block text-xs text-gray-500 leading-tight">(N/mmÂ²)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.gewicht.toLocaleString('de-DE')}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1 mt-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 rounded-xl text-left border border-amber-600"><div class="flex items-center"><span class="mr-2 text-xs">ğŸ›¡ï¸</span><div><span class="text-xs font-medium leading-tight">Dauerhaftigkeit</span><span class="block text-xs text-gray-500 leading-tight">(DK)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.dk}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 rounded-xl text-left border border-amber-600"><div class="flex items-center"><span class="mr-2 text-xs">ğŸ’</span><div><span class="text-xs font-medium leading-tight">Druckfestigkeit</span><span class="block text-xs text-gray-500 leading-tight">(N/mmÂ²)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.haerte}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 rounded-xl text-left border border-amber-600"><div class="flex items-center"><span class="mr-2 text-xs">â†”ï¸</span><div><span class="text-xs font-medium leading-tight">Quellen/Schw.</span><span class="block text-xs text-gray-500 leading-tight">(%)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.quellenSchwindenRadial}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 rounded-xl text-left border border-amber-600"><div class="flex items-center"><span class="mr-2 text-xs">âš–ï¸</span><div><span class="text-xs font-medium leading-tight">Rohdichte</span><span class="block text-xs text-gray-500 leading-tight">(kg/mÂ³)</span></div></div><span class="font-semibold text-amber-700 text-base">${cardData.dichte}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full flex justify-between items-center py-1 px-1 bg-amber-100 rounded-xl text-left border border-amber-600"><div class="flex items-center"><span class="mr-2 text-xs">ğŸ‹ï¸</span><div><span class="text-xs font-medium leading-tight">E-Modul</span><span class="block text-xs text-gray-500 leading-tight">(N/mmÂ²)</span></div></div><span class="font-bold text-amber-700 text-base">${cardData.gewicht.toLocaleString('de-DE')}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  cardFront.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center items-center w-full mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold text-amber-800 truncate">${cardData.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  ${isPlayer ? woodIconHTML : ''}
Â  Â  Â  Â  Â  Â  Â  Â  ${isPlayer ? infoButtonHTML : ''}
Â  Â  Â  Â  Â  Â  Â  Â  ${attributeButtons}
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  const cardBack = document.createElement('div');
Â  Â  Â  Â  Â  Â  cardBack.className = 'card-back rounded-xl shadow-lg border-2 border-amber-300 p-4 flex items-center justify-center relative overflow-hidden';

Â  Â  Â  Â  Â  Â  card.appendChild(cardFront);
Â  Â  Â  Â  Â  Â  card.appendChild(cardBack);
Â  Â  Â  Â  Â  Â  return card;
Â  Â  Â  Â  }

Â  Â  Â  Â  function displayCardsAI() {
Â  Â  Â  Â  Â  Â  const playerCardContainer = document.getElementById('playerCard');
Â  Â  Â  Â  Â  Â  const aiCardContainer = document.getElementById('aiCard');
Â  Â  Â  Â  Â  Â  playerCardContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  aiCardContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  playerCardContainer.appendChild(createCard(aiGame.currentPlayerCard, true, true));
Ã¡ Â  Â  Â  Â  aiCardContainer.appendChild(createCard(aiGame.currentAiCard, false, false));
Â  Â  Â  Â  }

Â  Â  Â  Â  function selectAttributeAI(attribute) {
Â  Â  Â  Â  Â  Â  if (aiGame.roundInProgress) return;
Â  Â  Â  Â  Â  Â  aiGame.roundInProgress = true;

Â  Â  Â  Â  Â  Â  const playerValue = aiGame.currentPlayerCard[attribute];
Â  Â  Â  Â  Â  Â  const aiValue = aiGame.currentAiCard[attribute];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('aiCard').querySelector('.card-3d').classList.remove('card-flipped');
Â  Â  Â  Â  Â  Â  playSound(sounds.flip); // NEU: Flip-Sound abspielen

Â  Â  Â  Â  Â  Â  const attributeButtons = document.querySelectorAll('#playerCard .space-y-1 > button');
Â  Â  Â  Â  Â  Â  attributeButtons.forEach(button => { button.disabled = true; button.classList.add('cursor-not-allowed', 'opacity-50'); });

Â  Â  Â  Â  Â  Â  let playerWins;
Â  Â  Â  Â  Â  Â  if (attribute === 'quellenSchwindenRadial' || attribute === 'dk') {
Â  Â  Â  Â  Â  Â  Â  Â  if (playerValue < aiValue) playerWins = true; else if (aiValue < playerValue) playerWins = false; else playerWins = 'tie';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (playerValue > aiValue) playerWins = true; else if (aiValue > playerValue) playerWins = false; else playerWins = 'tie';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let resultText, resultClass;
Â  Â  Â  Â  Â  Â  const playerCardFront = document.getElementById('playerCard').querySelector('.card-front');
Â  Â  Â  Â  Â  Â  const statusBar = document.getElementById('statusBar');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (playerWins === true) {
Â  Â  Â  Â  Â  Â  Â  Â  resultText = `ğŸ‰ Du gewinnst!`;
Â  Â  Â  Â  Â  Â  Â  Â  resultClass = 'text-green-600';
Â  Â  Â  Â  Â  Â  Â  Â  highlightAttribute(attribute, 'win');
Â  Â  Â  Â  Â  Â  Â  Â  aiGame.playerCards.push(aiGame.playerCards.shift(), aiGame.aiCards.shift());
Â  Â  Â  Â  Â  Â  Â  Â  if(playerCardFront) playerCardFront.classList.add('animate-glow-win');
Â  Â  Â  Â  Â  Â  Â  Â  if (statusBar) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBar.classList.add('status-flash-win');
s Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => statusBar.classList.remove('status-flash-win'), 1200);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  triggerWinStarAnimation();
Â  Â  Â  Â  Â  Â  Â  Â  playSound(sounds.win); // NEU: Win-Sound abspielen

Â  Â  Â  Â  Â  Â  } else if (playerWins === false) {
Â  Â  Â  Â  Â  Â  Â  Â  resultText = `ğŸ˜ KI gewinnt!`;
Â  Â  Â  Â  Â  Â  Â  Â  resultClass = 'text-red-600';
Â  Â  Â  Â  Â  Â  Â  Â  highlightAttribute(attribute, 'lose');
Â  Â  Â  Â  Â  Â  Â  Â  aiGame.aiCards.push(aiGame.aiCards.shift(), aiGame.playerCards.shift());
Â  Â  Â  Â  Â  Â  Â  Â  if(playerCardFront) playerCardFront.classList.add('animate-glow-lose');
Â  Â  Â  Â  Â  _ Â  Â  Â  if (statusBar) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBar.classList.add('status-flash-lose');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => statusBar.classList.remove('status-flash-lose'), 1200);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  resultText = `ğŸ¤ Unentschieden!`;
T Â  Â  Â  Â  Â  Â  Â  resultClass = 'text-yellow-600';
Â  Â  Â  Â  Â  Â  Â  Â  highlightAttribute(attribute, 'tie');
Â  Â  Â  Â  Â  Â  Â  Â  aiGame.playerCards.push(aiGame.playerCards.shift());
Â  Â  Â  Â  Â  Â  Â  Â  aiGame.aiCards.push(aiGame.aiCards.shift());
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  document.getElementById('resultText').textContent = resultText;
Â  Â  Â  Â  Â  Â  document.getElementById('resultText').className = `text-xl font-bold mb-1 ${resultClass}`;
Â  Â  Â  Â  Â  Â  document.getElementById('resultDetails').textContent = `${attributeInfo[attribute].name.split(' (')[0]}: ${playerValue.toLocaleString('de-DE')} vs ${aiValue.toLocaleString('de-DE')}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('attributeSelection').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('resultDisplay').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('nextRoundButton').classList.remove('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const woodIcon = document.getElementById(`wood-image-icon-${aiGame.currentPlayerCard.name.replace(/\s+/g, '-')}`);
Â  Â  Â  Â  Â  Â  const infoButton = document.getElementById(`player-info-button-${aiGame.currentPlayerCard.name.replace(/\s+/g, '-')}`);
Â  Â  Â  Â  Â  Â  if(woodIcon) woodIcon.classList.add('hidden');
Â  Â  Â  Â  Â  Â  if(infoButton) infoButton.classList.remove('hidden');


line-height: 1.25; Â  Â  Â  Â  updateDisplayAI();
Â  Â  Â  Â  Â  Â  checkGameOverAI();
Â  Â  Â  Â  }

Â  Â  Â  Â  function highlightAttribute(attribute, result) {
Â  Â  Â  Â  Â  Â  let playerBgColor = 'bg-gray-300', aiBgColor = 'bg-gray-300';

Â  Â  Â  Â  Â  Â  const idx = {'dk': 0, 'haerte': 1, 'quellenSchwindenRadial': 2, 'dichte': 3, 'gewicht': 4}[attribute];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.querySelectorAll('#playerCard .space-y-1 > *')[idx].classList.replace('bg-amber-100', playerBgColor);
Â  Â  Â  Â  Â  Â  document.querySelectorAll('#aiCard .space-y-1 > *')[idx].classList.replace('bg-amber-100', aiBgColor);
Â  Â  Â  Â  }

Â  Â  Â  Â  function nextRoundAI() {
Â  Â  Â  Â  Â  Â  const pf = document.getElementById('playerCard').querySelector('.card-front');
Â  Â  Â  Â  Â  Â  if (pf) pf.classList.remove('animate-glow-win', 'animate-glow-lose');
Â  Â  Â  Â  Â  Â  const af = document.getElementById('aiCard').querySelector('.card-front');
Â  Â  Â  Â  Â  Â  if (af) af.classList.remove('animate-glow-win', 'animate-glow-lose');

Â  Â  Â  Â  Â  Â  if (aiGame.playerCards.length === 0 || aiGame.aiCards.length === 0) { endGameAI(); return; }

Â  Â  Â  Â  Â  Â  aiGame.currentPlayerCard = aiGame.playerCards[0];
Â  Â  Â  Â  Â  Â  aiGame.currentAiCard = aiGame.aiCards[0];
Â  Â  Â  Â  Â  Â  aiGame.roundInProgress = false;

Â  Â  Â  Â  Â  Â  document.getElementById('attributeSelection').classList.remove('hidden');
s Â  Â  Â  Â  Â  document.getElementById('nextRoundButton').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('resultDisplay').classList.add('hidden');

Â  Â  Â  Â  Â  Â  displayCardsAI();
Â  Â  Â  Â  Â  Â  updateDisplayAI();
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateDisplayAI() {
Â  Â  Â  Â  Â  Â  const playerCount = aiGame.playerCards.length;
Â  Â  Â  Â  Â  Â  const opponentCount = aiGame.aiCards.length;
Â  Â  Â  Â  Â  Â  document.getElementById('playerCards').textContent = playerCount;
Â  Â  Â  Â  Â  Â  document.getElementById('aiCards').textContent = opponentCount;
Â  Â  Â  Â  Â  Â  updateStatusBar(playerCount, opponentCount);
Â  Â  Â  Â  }

Â  Â  Â  Â  function checkGameOverAI() {
Â  Â  Â  Â  Â  Â  if (aiGame.playerCards.length === 0 || aiGame.aiCards.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(endGameAI, 1200);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function triggerWinStarAnimation() {
Â  Â  Â  Â  Â  Â  const animationContainer = document.getElementById('animationContainer');
Â  Â  Â  Â  Â  Â  const playerScoreBox = document.getElementById('playerScoreBox');
Â  Â  Â  Â  Â  Â  const statusBar = document.getElementById('statusBar');

Â  Â  Â  Â  Â  Â  if (!animationContainer || !playerScoreBox || !statusBar) return;

Â  Â  Â  Â  Â  Â  const startRect = statusBar.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  const endRect = playerScoreBox.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  const containerRect = animationContainer.getBoundingClientRect();

Â  Â  Â  Â  Â  Â  const star = document.createElement('div');
CH Â  Â  Â  Â  Â  star.textContent = 'â­';
Â  Â  Â  Â  Â  Â  star.className = 'falling-star';

Â  Â  Â  Â  Â  Â  star.style.left = `${startRect.left - containerRect.left + startRect.width / 2 - 20}px`;
Â  Â  Â  Â  Â  Â  star.style.top = `${startRect.top - containerRect.top - 20}px`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const endY = endRect.top - startRect.top + endRect.height / 2;
Â  Â  Â  Â  Â  Â  star.style.setProperty('--end-y', `${endY}px`);

Â  Â  Â  Â  Â  Â  animationContainer.appendChild(star);

Â  Â  Â  Â  Â  Â  setTimeout(() => { star.remove(); }, 1200);
Examples Â  Â  Â  }

Â  Â  Â  Â  function endGame() {
Â  Â  Â  Â  Â  Â  if (gameMode === 'ai') { endGameAI(); return; }
Â  Â  Â  Â  Â  Â  const playerWon = localGameState.players[localPlayerId].cards.length > 0;
Â  Â  Â  Â  Â  Â  if (playerWon) {
Â  Â  Â  Â  Â  Â  Â  Â  saveToLeaderboard(localGameState.players[localPlayerId].name);
Â  Â  Â  Â  Â  Â  Â  Â  let qi = parseInt(localStorage.getItem('reflectionQuestionIndex') || '0');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reflectionQuestion').textContent = reflectionQuestions[qi];
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reflectionModal').classList.remove('hidden');
EX Â  Â  Â  Â  Â  Â  Â  qi = (qi + 1) % reflectionQuestions.length;
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('reflectionQuestionIndex', qi.toString());
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverTitle').textContent = 'ğŸ˜ Spiel verloren';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverTitle').className = `text-3xl font-bold mb-3 text-red-600`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverText').textContent = `Dein Mitspieler hat gewonnen. Versuche es nochmal!`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverModal').classList.remove('hidden');
Â  Â  Â  t Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function endGameAI() {
Â  Â  Â  Â  Â  Â  const playerWon = aiGame.playerCards.length > 0;
Â  Â  Â  Â  Â  Â  if (playerWon) {
Â  Â  Â  Â  Â  Â  Â  Â  saveToLeaderboard(aiGame.playerName);
Â  Â  Â  Â  Â  Â  Â  Â  let qi = parseInt(localStorage.getItem('reflectionQuestionIndex') || '0');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reflectionQuestion').textContent = reflectionQuestions[qi];
Â  Â  Source Â  Â  Â  Â  document.getElementById('reflectionModal').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  qi = (qi + 1) % reflectionQuestions.length;
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('reflectionQuestionIndex', qi.toString());
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverTitle').textContent = 'ğŸ˜ Spiel verloren';
s Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverTitle').className = `text-3xl font-bold mb-3 text-red-600`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverText').textContent = `Die KI hat gewonnen. Versuche es nochmal!`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gameOverModal').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showFinalWinScreen = function() {
S Â  Â  Â  Â  document.getElementById('reflectionModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('reflectionAnswer').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('gameOverTitle').textContent = 'ğŸ‰ GlÃ¼ckwunsch!';
Â  Â  Â  Â  Â  Â  document.getElementById('gameOverTitle').className = `text-3xl font-bold mb-3 text-green-600`;
Â  Â  Â  Â  Â  Â  const winnerName = gameMode === 'ai' ? aiGame.playerName : localGameState.players[localPlayerId].name;
Â  Â  Â  Â  Â  Â  document.getElementById('gameOverText').textContent = `Du hast gewonnen, ${winnerName}! Du hast alle Karten gesammelt.`;
s Â  Â  Â  Â  Â  document.getElementById('gameOverModal').classList.remove('hidden');
Â  Â  Â  Â  };

Â  Â  Â  Â  async function saveToLeaderboard(playerName) {
Â  Â  Â  Â  Â  Â  if (!playerName) return;
Â  Â  Â  Â  Â  Â  const leaderboardRef = doc(db, "leaderboard", playerName);
s Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(leaderboardRef, { name: playerName, wins: increment(1), lastWin: serverTimestamp() }, { merge: true });
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error updating leaderboard:", error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showLeaderboard = async function() {
Â  Â  Â  Â  Â  Â  const list = document.getElementById('leaderboardList');
Â  Â  Â  Â  Â  Â  list.innerHTML = '<p class="text-gray-500 text-center">Lade Bestenliste...</p>';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('gameOverModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('leaderboardModal').classList.remove('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const q = query(collection(db, "leaderboard"), orderBy("wins", "desc"), limit(10));
Methods Â  Â  Â  Â  Â  Â  const querySnapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â  if (querySnapshot.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '<p class="text-gray-500 text-center">Noch keine EintrÃ¤ge</p>';
New Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = querySnapshot.docs.map((doc, i) => `<div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"><span class="font-semibold">${i + 1}. ${doc.data().name}</span><span class="text-sm text-gray-600">${doc.data().wins} Siege</span></div>`).join('');
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching leaderboard:", error);
Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '<p class="text-red-500 text-center">Fehler beim Laden der Bestenliste.</p>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.closeLeaderboard = function() {
Â  Â  Â  Â  Â  Â  document.getElementById('leaderboardModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('gameOverModal').classList.remove('hidden');
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.resetGame = async function() {
Â  Â  Â  Â  Â  Â  if (unsubscribeGame) unsubscribeGame();
Â  Â  Â  Â  Â  Â  if (gameMode === 'multiplayer' && gameId) {
Â  Â  Â  Â  Â  Â  Â  Â  try { await deleteDoc(doc(db, "games", gameId)); } catch {}
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  aiGame = { playerName: '', playerCards: [], aiCards: [], currentPlayerCard: null, currentAiCard: null, roundInProgress: false };
Â  Â  Â  Â  Â  Â  gameMode = null; gameId = null; unsubscribeGame = null;

Â  Â  Â  Â  Â  Â  document.getElementById('gameOverModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('leaderboardModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('reflectionModal').classList.add('hidden');
E Â  Â  Â  Â  Â  document.getElementById('gameContainer').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('setupModal').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('playerName').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('infoModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('reflectionAnswer').value = '';
Â  Â  Â  Â  Â  Â  window.history.pushState({}, document.title, window.location.pathname);
Services Â  Â  Â  };

Â  Â  Â  Â  window.showWoodInfo = function(woodName) {
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('infoModal');
Â  Â  Â  Â  Â  Â  document.getElementById('infoModalTitle').textContent = `Wissenswertes Ã¼ber ${woodName}`;
Â  Â  Â  Â  Â  Â  const content = document.getElementById('infoModalContent');
Â  Â  Â  Â  Â  Â  const infoData = woodInfo[woodName] || woodInfo[Object.keys(woodInfo).find(k => k.toLowerCase() === woodName.toLowerCase())];

Example Â  Â  Â  Â  Â  Â  if (infoData) {
Â  Â  Â  Â  Â  Â  Â  Â  content.innerHTML = `<p>${infoData.info}</p><div class="space-y-4 mt-4"><div><h4 class="font-semibold mb-2 text-center">Baum</h4><img src="${infoData.bildBaum}" alt="Bild von ${woodName} Baum" class="w-full h-auto rounded-lg object-cover" onerror="this.style.display='none'"></div><div><h4 class="font-semibold mb-2 text-center">Querschnitt</h4><img src="${infoData.bildQuerschnitt}" alt="Bild von ${woodName} Querschnitt" class="w-full h-auto rounded-lg object-cover" onerror="this.style.display='none'"></div></div>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  content.innerHTML = "<p>FÃ¼r diese Holzart sind aktuell keine Informationen verfÃ¼gbar.</p>";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  modal.classList.remove('hidden');
Â  Â  Â  Â  };

Â  Â  Â  Â  window.closeInfoModal = function() {
Â  Â  Â  Â  Â  Â  document.getElementById('infoModal').classList.add('hidden');
s Â  Â  Â  };

Â  Â  </script>
</body>
</html>
