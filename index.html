<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Holz-Quartett</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-weight: 300;
        }

        .card-3d {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card-flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .wood-texture {
            background: linear-gradient(45deg, #8B4513 25%, transparent 25%), 
                        linear-gradient(-45deg, #8B4513 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #8B4513 75%), 
                        linear-gradient(-45deg, transparent 75%, #8B4513 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #D2B48C;
            opacity: 0.1;
        }

        .animate-pop-in {
            animation: pop-in 0.5s ease-out forwards;
        }

        .animate-glow-win {
            animation: glow-win 1.2s ease-out;
        }

        .animate-glow-lose {
            animation: glow-lose 1.2s ease-out;
        }

        @keyframes pop-in {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }

        @keyframes glow-win {
            0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); } /* green-400 */
            50% { box-shadow: 0 0 30px 15px rgba(74, 222, 128, 0.6); }
            100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
        }

        @keyframes glow-lose {
            0% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
    .border-flash-win { animation: border-win 1.2s ease-out; border-width: 3px !important; border-style: solid; }
    .border-flash-lose { animation: border-lose 1.2s ease-out; border-width: 3px !important; border-style: solid; }
    @keyframes border-win {
      0% { border-color: rgba(34,197,94,0); }     /* green-500 */
      50% { border-color: rgba(34,197,94,1); }
      100% { border-color: rgba(34,197,94,0); }
    }
    @keyframes border-lose {
      0% { border-color: rgba(239,68,68,0); }     /* red-500 */
      50% { border-color: rgba(239,68,68,1); }
      100% { border-color: rgba(239,68,68,0); }
    }
     /* red-400 */
            50% { box-shadow: 0 0 30px 15px rgba(248, 113, 113, 0.6); }
            100% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
        }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
    </style>
    <script>
        // Preload card images for better performance
        const imageUrls = [
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/eiche_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/buche_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kiefer_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/fichte_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/tanne_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/laerche_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/birke_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ahorn_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/esche_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kirsche_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/nussbaum_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/douglasie_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zeder_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/mahagoni_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/teak_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/bambus_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/pappel_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/weide_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/linde_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ulme_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kastanie_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/robinie_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hemlock_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zypresse_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/redwood_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hickory_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/wenge_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zebrano_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/palisander_1.jpg?raw=true",
          "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ebenholz_1.jpg?raw=true"
        ];
        imageUrls.forEach(url => {
            if (!url) return;
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'image';
            link.href = url;
            document.head.appendChild(link);
        });
    </script>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b-2 border-amber-200">
        <div class="max-w-6xl mx-auto px-4 p-3">
            <h1 class="text-2xl font-bold text-amber-800 text-center">üå≥ Holz-Quartett</h1>
            <p class="text-xs text-gray-500 text-center mt-1">von Christopher Lehr, in Verbindung mit meiner Masterarbeit</p>
        </div>
    </header>

    <!-- Game Mode Selection Modal -->
    <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl text-center">
            <h2 class="text-2xl font-bold text-amber-800 mb-6">Spielmodus w√§hlen</h2>
            <div class="space-y-4">
                <button onclick="showNamePrompt('ai')" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors text-lg">
                    üéÆ Gegen Computer spielen
                </button>
                <button onclick="showNamePrompt('multiplayer')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors text-lg">
                    üßë‚Äçü§ù‚Äçüßë Mit Freund online spielen
                </button>
            </div>
        </div>
    </div>

    <!-- Name Input Modal -->
    <div id="nameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-amber-800 mb-6 text-center">Dein Name</h2>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Bitte gib deinen Namen ein:</label>
                    <input type="text" id="playerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="Spielername">
                </div>
                <button id="nameSubmitButton" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                    Weiter
                </button>
            </div>
        </div>
    </div>

    <!-- Multiplayer Lobby Modal -->
    <div id="multiplayerLobbyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl text-center">
            <h2 id="lobbyTitle" class="text-2xl font-bold text-amber-800 mb-4">Warte auf Mitspieler...</h2>
            <p id="lobbyText" class="text-gray-700 mb-6">Teile diesen Link mit deinem Freund, um das Spiel zu starten:</p>
            <div class="bg-gray-100 p-3 rounded-lg border border-gray-300">
                <input id="shareLink" type="text" class="w-full bg-transparent text-center text-blue-600" readonly>
            </div>
            <button onclick="copyShareLink()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                Link kopieren
            </button>
            <p id="lobbyStatus" class="mt-6 text-green-600 font-semibold"></p>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer" class="hidden max-w-6xl mx-auto px-4 py-4">
        <!-- Score & Status Panel -->
        <div class="max-w-md mx-auto mb-3 space-y-1">
            <div class="flex justify-center space-x-2">
                <!-- Player Score Box -->
                <div class="w-1/2 bg-white rounded-xl shadow-lg p-2 text-center">
                    <p id="playerNameDisplay" class="text-base font-bold text-red-600 truncate"></p>
                    <p class="text-sm text-gray-500">Karten: <span id="playerCards" class="font-semibold">15</span></p>
                </div>
                <!-- Opponent Score Box -->
                <div class="w-1/2 bg-white rounded-xl shadow-lg p-2 text-center">
                    <p id="opponentNameDisplay" class="text-base font-bold text-red-600">Computer</p>
                    <p class="text-sm text-gray-500">Karten: <span id="aiCards" class="font-semibold">15</span></p>
                </div>
            </div>
            <!-- Status Bar -->
            <div class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden border border-gray-300">
                <div id="statusBar" class="h-full rounded-l-full transition-all duration-500" style="width: 50%; background-color: #f59e0b;"></div>
                <div class="absolute inset-0 flex justify-center items-center">
                    <div class="w-0.5 h-full bg-white opacity-75"></div>
                </div>
            </div>
        </div>

        <!-- Game Board -->
        <div class="flex justify-center space-x-2 sm:space-x-2 mb-4 max-w-md mx-auto">
            <!-- Player Card -->
            <div class="text-center w-1/2">
                <div id="playerCard" class="relative aspect-[20/38] perspective-1000"></div>
            </div>
            <!-- Opponent Card -->
            <div class="text-center w-1/2">
                <div id="aiCard" class="relative aspect-[20/38] perspective-1000"></div>
            </div>
        </div>

        <!-- Action Panel -->
        <div class="bg-white rounded-xl shadow-lg p-1 mt-4 text-center mx-auto flex flex-col items-center justify-center max-w-md w-full">
            <div id="turnIndicator" class="hidden text-sm font-semibold p-2"></div>
            <div id="attributeSelection" class="">
                 <h3 class="text-lg font-semibold text-gray-700">W√§hle eine Eigenschaft!</h3>
            </div>
            <div id="nextRoundButton" class="hidden w-full mb-1">
                 <button onclick="nextRound()" class="w-full bg-amber-600 hover:bg-amber-800 text-white font-bold py-3 px-8 rounded-xl transition-colors">
                     ‚û°Ô∏è N√§chster Zug
                 </button>
             </div>
            <div id="resultDisplay" class="hidden">
                 <h3 id="resultText" class="text-xl font-bold mb-1"></h3>
                 <p id="resultDetails" class="text-sm text-gray-600"></p>
            </div>
        </div>
    </div>

    <!-- Reflection Modal -->
    <div id="reflectionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl text-center">
            <h2 class="text-2xl font-bold text-amber-800 mb-4">üéâ Super gespielt! Zeit zum Reflektieren!</h2>
            <p id="reflectionQuestion" class="text-gray-700 mb-6 text-left"></p>
            <textarea id="reflectionAnswer" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent min-h-[100px]" placeholder="Deine Begr√ºndung..."></textarea>
            <button onclick="showFinalWinScreen()" class="mt-6 w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                Weiter zum Ergebnis
            </button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl text-center">
            <h2 id="gameOverTitle" class="text-3xl font-bold mb-3"></h2>
            <p id="gameOverText" class="text-gray-600 mb-6"></p>
            <div class="space-y-2">
                <button onclick="showLeaderboard()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg">
                    üèÜ Bestenliste anzeigen
                </button>
                <button onclick="resetGame()" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg">
                    üîÑ Neues Spiel
                </button>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex itemscenter justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-amber-800 mb-4 text-center">üèÜ Bestenliste</h2>
            <div id="leaderboardTop" class="mb-4"></div>
            <div id="leaderboardList" class="space-y-1 mb-6"></div>
            <div class="flex gap-2">
              <button onclick="resetLeaderboardStorage()" class="w-1/2 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg">
                Zur√ºcksetzen
              </button>
              <button onclick="closeLeaderboard()" class="w-1/2 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg">
                Schlie√üen
              </button>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 px-4">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl relative">
            <button onclick="closeInfoModal()" class="absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-600">&times;</button>
            <h2 id="infoModalTitle" class="text-2xl font-bold text-amber-800 mb-4">Wissenswertes</h2>
            <div id="infoModalContent" class="text-gray-700 space-y-2 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script type="module">
        // (JS identical to the previous cell's, omitted here to keep the retry short)
    </script>
</body>
</html>
