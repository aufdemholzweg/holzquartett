<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Holz-Quartett</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QR-Code-Bibliothek f√ºr Multiplayer-Link -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-weight: 300;
        }
        .card-3d {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card-flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .card-back {
            transform: rotateY(180deg);
            background-image: url('https://raw.githubusercontent.com/aufdemholzweg/holzquartett/65fd843a4db1ee434faaf81a32f77951a5afb72a/images/background_card.jpg');
            background-size: cover;
            background-position: center;
        }
        .wood-texture {
            background: linear-gradient(45deg, #8B4513 25%, transparent 25%),
                        linear-gradient(-45deg, #8B4513 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #8B4513 75%),
                        linear-gradient(-45deg, transparent 75%, #8B4513 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #D2B48C;
            opacity: 0.1;
        }
        .animate-pop-in {
            animation: pop-in 0.5s ease-out forwards;
        }
        .animate-glow-win {
            animation: glow-win 1.2s ease-out;
        }
        .animate-glow-lose {
            animation: glow-lose 1.2s ease-out;
        }
        @keyframes pop-in {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        @keyframes glow-win {
            0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
            50% { box-shadow: 0 0 30px 15px rgba(74, 222, 128, 0.6); }
            100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
        }
        @keyframes glow-lose {
            0% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
            50% { box-shadow: 0 0 30px 15px rgba(248, 113, 113, 0.6); }
            100% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .status-flash-win {
            animation: flash-green 1.2s ease-out;
        }
        .status-flash-lose {
            animation: flash-red 1.2s ease-out;
        }
        @keyframes flash-green {
          50% { background-color: #22c55e; box-shadow: 0 0 15px #22c55e; }
        }
        @keyframes flash-red {
          50% { background-color: #ef4444; box-shadow: 0 0 15px #ef4444; }
        }
        .falling-star {
            position: absolute;
            font-size: 7rem;
            z-index: 100;
            animation: fall-and-fade 1.2s ease-in forwards;
        }
        @keyframes fall-and-fade {
            0% { transform: translateY(-30px) scale(1.5); opacity: 0; }
            30% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(var(--end-y)) scale(0.3); opacity: 0; }
        }
        .card-background {
            background-image: url('https://raw.githubusercontent.com/aufdemholzweg/holzquartett/e7cfc18394e2e7f2d0b91df1138b0d7bc7930699/images/background_front.jpg');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen">
    <header class="bg-white shadow-sm border-b-2 border-amber-200">
        <div class="max-w-6xl mx-auto px-4 p-3">
            <h1 class="text-2xl font-bold text-amber-800 text-center">üå≥ HOLZEN! üå≥</h1>
            <p class="text-xs text-gray-500 text-center mt-1">von Christopher Lehr, in Verbindung mit meiner Masterarbeit</p>
        </div>
    </header>
    <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl text-center">
            <h2 class="text-2xl font-bold text-amber-800 mb-6">Spielmodus w√§hlen</h2>
            <div class="space-y-4">
                <button onclick="window.showNamePrompt('ai')" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors text-lg">
                    üéÆ gegen Computer
                </button>
                <button onclick="window.showNamePrompt('multiplayer')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors text-lg">
                    üßë‚Äçü§ù‚Äçüßë online gegen Freunde
                </button>
            </div>
            <div class="mt-6 flex items-center justify-center space-x-2">
                <span class="text-gray-700">üîá </span>
                <label for="soundToggle" class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="soundToggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-amber-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-600"></div>
                </label>
                <span class="text-gray-700"> üîä</span>
            </div>
        </div>
    </div>
    <div id="nameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-amber-800 mb-6 text-center">Dein Name</h2>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Bitte gib deinen Namen ein:</label>
                    <input type="text" id="playerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="Spielername">
                </div>
                <button id="nameSubmitButton" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                    Weiter
                </button>
            </div>
        </div>
    </div>
    <div id="multiplayerLobbyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl text-center">
            <h2 id="lobbyTitle" class="text-2xl font-bold text-amber-800 mb-4">Warte auf Mitspieler...</h2>
            <p id="lobbyText" class="text-gray-700 mb-6">Teile diesen Link mit deinem Freund, um das Spiel zu starten:</p>
            <div class="bg-gray-100 p-3 rounded-lg border border-gray-300">
                <input id="shareLink" type="text" class="w-full bg-transparent text-center text-blue-600" readonly>
            </div>
            <button onclick="window.copyShareLink()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                Link kopieren
            </button>
            <div id="qrContainer" class="mt-4 flex justify-center"></div>
            <p id="lobbyStatus" class="mt-6 text-green-600 font-semibold"></p>
        </div>
    </div>
    <div id="gameContainer" class="hidden max-w-6xl mx-auto px-4 py-4 relative">
        <div id="animationContainer" class="absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden"></div>
        <div class="max-w-md mx-auto mb-1 space-y-1">
            <div class="flex justify-center space-x-2">
                <div id="playerScoreBox" class="w-1/2 bg-white rounded-xl shadow-lg p-2 text-center relative">
                    <p id="playerNameDisplay" class="text-base font-bold text-amber-600 truncate"></p>
                    <p class="text-sm text-gray-500">Karten: <span id="playerCards" class="font-semibold">15</span></p>
                </div>
                <div class="w-1/2 bg-white rounded-xl shadow-lg p-2 text-center">
                    <p id="opponentNameDisplay" class="text-base font-bold text-red-600">Computer</p>
                    <p class="text-sm text-gray-500">Karten: <span id="aiCards" class="font-semibold">15</span></p>
                </div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden border border-gray-300">
                <div id="statusBar" class="h-full rounded-l-full transition-all duration-500" style="width: 50%; background-color: #f59e0b;"></div>
                <div class="absolute inset-0 flex justify-center items-center">
                    <div class="w-0.5 h-full bg-white opacity-75"></div>
                </div>
            </div>
        </div>
        <div class="flex justify-center space-x-2 sm:space-x-2 mb-4 max-w-md mx-auto">
            <div class="text-center w-1/2">
                <div id="playerCard" class="relative aspect-[20/38] perspective-1000"></div>
            </div>
            <div class="text-center w-1/2">
                <div id="aiCard" class="relative aspect-[20/38] perspective-1000"></div>
            </div>
        </div>
        <div class="bg-white rounded-xl shadow-lg px-1 pt-1 pb-0.5 mt-4 text-center mx-auto flex flex-col items-center max-w-md w-full min-h-[6rem]">
            <div id="turnIndicator" class="hidden text-sm font-semibold p-1"></div>
            <div id="attributeSelection" class="">
                <h3 class="text-base font-semibold text-gray-700 mb-1">W√§hle eine Eigenschaft!</h3>
            </div>
            <div id="resultDisplay" class="hidden flex flex-col flex-grow w-full px-2">
                <h3 id="resultText" class="text-lg sm:text-xl font-bold"></h3>
                <p id="resultDetails" class="text-xs sm:text-sm text-gray-600 mt-auto pb-0.5"></p>
            </div>
            <div id="nextRoundButton" class="hidden w-full mt-2">
                <button onclick="window.nextRound()" class="w-full bg-amber-600 hover:bg-amber-800 text-white font-bold py-3 px-8 rounded-xl transition-colors">
                    ‚û°Ô∏è N√§chster Zug
                </button>
            </div>
        </div>
    </div>
    <div id="reflectionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl text-center">
            <h2 class="text-2xl font-bold text-amber-800 mb-4">üéâ Super gespielt! Zeit zum Reflektieren!</h2>
            <p id="reflectionQuestion" class="text-gray-700 mb-6 text-left"></p>
            <textarea id="reflectionAnswer" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent min-h-[100px]" placeholder="Deine Begr√ºndung..."></textarea>
            <button onclick="window.showFinalWinScreen()" class="mt-6 w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                Weiter zum Ergebnis
            </button>
        </div>
    </div>
    <div id="gameOverModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl text-center">
            <h2 id="gameOverTitle" class="text-3xl font-bold mb-3"></h2>
            <p id="gameOverText" class="text-gray-600 mb-6"></p>
            <div class="space-y-2">
                <button onclick="window.showLeaderboard()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg">
                    üèÜ Bestenliste anzeigen
                </button>
                <button onclick="window.resetGame()" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg">
                    üîÑ Neues Spiel
                </button>
            </div>
        </div>
    </div>
    <div id="leaderboardModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-amber-800 mb-6 text-center">üèÜ Bestenliste</h2>
            <div id="leaderboardList" class="space-y-1 mb-6"></div>
            <button onclick="window.closeLeaderboard()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg">
                Schlie√üen
            </button>
        </div>
    </div>
    <div id="infoModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 px-4">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 shadow-2xl relative">
            <button onclick="window.closeInfoModal()" class="absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-600">&times;</button>
            <h2 id="infoModalTitle" class="text-2xl font-bold text-amber-800 mb-4">Wissenswertes</h2>
            <div id="infoModalContent" class="text-gray-700 space-y-2 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, serverTimestamp, deleteDoc, collection, query, orderBy, limit, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCyRXl8-JPr1xTXPDi1VG-eQk6fOnTpqUI",
            authDomain: "holzquartett-3a177.firebaseapp.com",
            projectId: "holzquartett-3a177",
            storageBucket: "holzquartett-3a177.appspot.com",
            messagingSenderId: "1081595025073",
            appId: "1:1081595025073:web:bc571fffb6e4f20b27f490",
            measurementId: "G-HKLWFJE83K"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = firebaseConfig.projectId;

        let gameMode = null;
        let gameId = null;
        let localPlayerId = null;
        let unsubscribeGame = null;
        let localGameState = {};
        let hasCopiedShareLink = false;
        let isMuted = false;

        const sounds = {
            flip: new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_139083c224.mp3'),
            win: new Audio('https://github.com/aufdemholzweg/holzquartett/blob/894e048eea71ba49921abfe6827bd8dc723f8c2d/gewonnen.mp3?raw=true'),
            chime: new Audio('https://cdn.pixabay.com/audio/2021/08/04/audio_12b0c744c8.mp3'),
            starWin: new Audio('https://cdn.pixabay.com/audio/2022/10/28/audio_73b90209e7.mp3')
        };
        sounds.flip.volume = 0.5;
        sounds.win.volume = 0.4;
        sounds.chime.volume = 0.6;
        sounds.starWin.volume = 0.7;

        function playSound(sound) {
            if (isMuted) return;
            sound.currentTime = 0;
            sound.play().catch(e => console.log("Sound playback error:", e));
        }
        let roundSoundPlayed = false;

        const woodCards = [
            {name: "Eiche", dk: 2, haerte: 85, quellenSchwindenRadial: 4.0, dichte: 650, gewicht: 12000},
            {name: "Buche", dk: 5, haerte: 80, quellenSchwindenRadial: 5.8, dichte: 720, gewicht: 14000},
            {name: "Kiefer", dk: 3, haerte: 40, quellenSchwindenRadial: 3.5, dichte: 520, gewicht: 11000},
            {name: "Fichte", dk: 4, haerte: 35, quellenSchwindenRadial: 3.6, dichte: 450, gewicht: 11000},
            {name: "Tanne", dk: 4, haerte: 38, quellenSchwindenRadial: 3.5, dichte: 460, gewicht: 10000},
            {name: "L√§rche", dk: 3, haerte: 55, quellenSchwindenRadial: 3.7, dichte: 590, gewicht: 12000},
            {name: "Birke", dk: 5, haerte: 60, quellenSchwindenRadial: 5.4, dichte: 650, gewicht: 13000},
            {name: "Ahorn", dk: 5, haerte: 75, quellenSchwindenRadial: 4.8, dichte: 630, gewicht: 12500},
            {name: "Esche", dk: 5, haerte: 90, quellenSchwindenRadial: 4.9, dichte: 700, gewicht: 13000},
            {name: "Kirsche", dk: 3, haerte: 70, quellenSchwindenRadial: 4.0, dichte: 600, gewicht: 11500},
            {name: "Nussbaum", dk: 3, haerte: 65, quellenSchwindenRadial: 4.0, dichte: 640, gewicht: 12000},
            {name: "Douglasie", dk: 3, haerte: 45, quellenSchwindenRadial: 3.5, dichte: 510, gewicht: 12000},
            {name: "Zeder", dk: 2, haerte: 42, quellenSchwindenRadial: 2.8, dichte: 480, gewicht: 9500},
            {name: "Mahagoni", dk: 2, haerte: 55, quellenSchwindenRadial: 3.0, dichte: 550, gewicht: 10500},
            {name: "Teak", dk: 1, haerte: 60, quellenSchwindenRadial: 2.5, dichte: 650, gewicht: 11000},
            {name: "Bambus", dk: 4, haerte: 50, quellenSchwindenRadial: 3.0, dichte: 400, gewicht: 18000},
            {name: "Pappel", dk: 5, haerte: 25, quellenSchwindenRadial: 4.5, dichte: 380, gewicht: 9000},
            {name: "Weide", dk: 5, haerte: 30, quellenSchwindenRadial: 4.0, dichte: 420, gewicht: 8000},
            {name: "Linde", dk: 5, haerte: 35, quellenSchwindenRadial: 3.8, dichte: 530, gewicht: 9000},
            {name: "Ulme", dk: 3, haerte: 75, quellenSchwindenRadial: 4.5, dichte: 680, gewicht: 11500},
            {name: "Kastanie", dk: 2, haerte: 50, quellenSchwindenRadial: 3.5, dichte: 600, gewicht: 10000},
            {name: "Robinie", dk: 1, haerte: 80, quellenSchwindenRadial: 3.0, dichte: 730, gewicht: 15000},
            {name: "Hemlock", dk: 4, haerte: 40, quellenSchwindenRadial: 3.6, dichte: 500, gewicht: 10000},
            {name: "Zypresse", dk: 2, haerte: 48, quellenSchwindenRadial: 3.0, dichte: 520, gewicht: 9000},
            {name: "Redwood", dk: 2, haerte: 35, quellenSchwindenRadial: 2.8, dichte: 400, gewicht: 8500},
            {name: "Hickory", dk: 3, haerte: 95, quellenSchwindenRadial: 5.5, dichte: 750, gewicht: 14000},
            {name: "Wenge", dk: 2, haerte: 88, quellenSchwindenRadial: 3.8, dichte: 880, gewicht: 16000},
            {name: "Zebrano", dk: 3, haerte: 70, quellenSchwindenRadial: 4.0, dichte: 750, gewicht: 13000},
            {name: "Palisander", dk: 2, haerte: 82, quellenSchwindenRadial: 3.0, dichte: 850, gewicht: 16000},
            {name: "Ebenholz", dk: 1, haerte: 98, quellenSchwindenRadial: 3.2, dichte: 1200, gewicht: 16500}
        ];

        const woodInfo = {
             "Eiche": { info: `Eiche (QE) Die Eiche z√§hlt zu den bedeutendsten heimischen Laubh√∂lzern Europas. Ihr Holz ist hart, schwer und sehr dauerhaft, was sie zu einem bevorzugten Werkstoff im Innen‚Äë und Au√üenbereich macht. Besonders charakteristisch sind die hohen Gerbstoffanteile, die das Holz widerstandsf√§hig gegen Pilze und Sch√§dlinge machen ‚Äì gleichzeitig k√∂nnen sie beim Kontakt mit Eisen zu Verf√§rbungen f√ºhren. Eichenholz ist grobporig und zeigt einen deutlichen √úbergang zwischen Fr√ºh- und Sp√§tholz, wodurch die Jahresringe klar sichtbar sind. Diese ausgepr√§gte Maserung sorgt f√ºr eine markante, lebendige Optik. Verwendung: M√∂bel, Fu√üb√∂den, Treppen, Fassdauben (z.‚ÄØB. f√ºr Weinf√§sser), Schiffbau, Terrassen, Br√ºcken, Fachwerk. Funfact: Bereits in der Antike galt die Eiche als Symbol f√ºr St√§rke und Best√§ndigkeit ‚Äì sie ziert bis heute zahlreiche Wappen und M√ºnzen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/eiche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/eiche_2.jpg?raw=true" },
             "Buche": { info: `Buche (BU) Die Buche ist ein gleichm√§√üig strukturiertes Hartholz heimischer W√§lder. Ihr Holz ist z√§h, biegsam und relativ harzarm, wodurch es sich sehr gut f√ºr M√∂bel und Parkett eignet. Buchenholz ist ringporig mit mittelgro√üen Poren im Fr√ºhholz und dichterem Sp√§tholz, sodass die √úberg√§nge dezent sichtbar sind ‚Äì die Jahresringe sind gut erkennbar, aber nicht grob. Verwendung: M√∂bel, Parkett, Furniere, Sperrholz, Innenausbau. Funfact: Buchenholz war lange Zeit typisch f√ºrs Wagenrad ‚Äì wegen seiner Kombination aus Z√§higkeit und Elastizit√§t.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/buche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/buche_2.jpg?raw=true" },
             "Kiefer": { info: `Kiefer (KI) Kiefer ist ein weit verbreitetes Nadelholz mit markanter Jahresringstruktur. Es ist weich, harzhaltig und relativ leicht zu bearbeiten. Das Holz zeigt keine ausgepr√§gten gro√üen Poren wie Laubh√∂lzer, sondern eine eher gleichm√§√üige Zellstruktur ‚Äì Jahresringe und Harzkan√§le sind sichtbar. Verwendung: Bauholz, Dachst√ºhle, Innenausbau, M√∂bel, Paneele. Funfact: Kiefernharz wurde fr√ºher als Klebstoff oder als Bestandteil von Salben und Dichtungsmaterialien verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kiefer_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kiefer_2.jpg?raw=true" },
             "Fichte": { info: `Fichte (FI) Fichte ist ein klassisches Bauholz mit guter Festigkeit bei geringem Gewicht. Es l√§sst sich leicht bearbeiten und vielfach einsetzen. Das Holz weist eine feine Zellstruktur auf, ohne gro√üe Poren ‚Äì Jahresringe sind erkennbar, aber nicht grob. Verwendung: Bauholz, Innenverkleidung, Dach, M√∂bel, Paneele. Funfact: In vielen Gebirgsregionen war Fichtenholz √ºber Jahrhunderte hinweg der Standard f√ºr Dachkonstruktionen und S√§gewerke.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/fichte_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/fichte_2.jpg?raw=true" },
             "Tanne": { info: `Tanne (TA) Tanne ist ein harzarmes, vergleichsweise feines Nadelholz, das oft als Alternative zur Fichte verwendet wird. Die Struktur √§hnelt der Fichte: feine Fasern, dezente Jahresringe, keine ausgepr√§gten Poren. Verwendung: Innenausbau, M√∂bel, Paneele, Bauholz. Funfact: Da Tanne weniger Harz enth√§lt, ist sie angenehmer in R√§umen einzusetzen, da sie weniger Geruch abgibt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/tanne_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/tanne_2.jpg?raw=true" },
             "L√§rche": { info: `L√§rche (LA) L√§rche ist bekannt f√ºr ihre nat√ºrliche Witterungsbest√§ndigkeit und sch√∂ne Farbe. Sie kombiniert Elastizit√§t mit Festigkeit. Das Holz zeigt ausgepr√§gte Jahresringe und Harzkan√§le ‚Äì die Struktur ist deutlich sichtbar. Verwendung: Fassadenholz, Fenster, Terrassen, Au√üenbau, M√∂bel. Funfact: L√§rchenholz wird h√§ufig ohne chemische Behandlung im Au√üenbereich eingesetzt und erh√§lt mit der Zeit eine edle Vergrauung.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/laerche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/laerche_2.jpg?raw=true" },
             "Birke": { info: `Birke (BI) Birke ist ein helles, dekoratives Holz mit feiner, gleichm√§√üiger Struktur. Es √ºberzeugt durch gute Biegsamkeit. Das Holz ist zerstreutporig ‚Äì Poren sind fein verteilt, ohne gro√üe Unterschiede zwischen Fr√ºh- und Sp√§tholz. Verwendung: M√∂bel, Furniere, Sperrholz, Innenausbau. Funfact: Birkenrinde wurde fr√ºher als wasserabweisendes Material f√ºr Beh√§lter und Boote genutzt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/birke_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/birke_2.jpg?raw=true" },
             "Ahorn": { info: `Ahorn (AM) Ahorn ist hart, hell und elegant ‚Äì ideal f√ºr feine M√∂bel, Instrumente und Designanwendungen. Es handelt sich ebenfalls um ein zerstreutporiges Holz mit gleichm√§√üiger Porenverteilung, ohne starke √úberg√§nge zwischen Fr√ºh‚Äë und Sp√§tholz. Verwendung: M√∂bel, Parkett, Instrumente, Schneidebretter. Funfact: Aus Ahorn gewinnt man auch Ahornsirup ‚Äì allerdings aus nordamerikanischen Arten, nicht unbedingt jene zum M√∂belbau.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ahorn_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ahorn_2.jpg?raw=true" },
             "Esche": { info: `Esche (ES) Die Esche ist ein besonders z√§hes, elastisches Holz mit hoher Festigkeit. Sie zeigt ringporige Struktur mit deutlich sichtbaren Poren im Fr√ºhholz und schmaleren Poren im Sp√§tholz. Verwendung: Werkzeugstiele, Sportger√§te, M√∂bel, Parkett, Innenausbau. Funfact: In der Antike wurden Wagenr√§der und Speichen h√§ufig aus Esche gefertigt ‚Äì wegen ihrer elastischen Eigenschaften.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/esche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/esche_2.jpg?raw=true" },
             "Kirsche": { info: `Kirsche (KR) Kirschbaumholz besitzt warme rote T√∂ne, die mit Licht nachdunkeln, und eine edle Struktur. Ringporig mit deutlichem √úbergang zwischen Fr√ºh- und Sp√§tholz ‚Äì Jahresringe sind gut sichtbar. Verwendung: M√∂bel, Furniere, Innenausbau, Dekor. Funfact: Kirschholz wird oft in M√∂beln verwendet, die mit der Zeit ‚Äúreifer‚Äù aussehen ‚Äì die Farbe verbessert sich mit Alterung.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kirsche_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kirsche_2.jpg?raw=true" },
             "Nussbaum": { info: `Nussbaum (NU) Nussbaumholz ist dunkel, dekorativ und sehr hochwertig. Das Kernholz hat oft starken Farbkontrast zum Splintholz. Es ist zerstreutporig ‚Äì Poren sind fein √ºber die Fl√§che verteilt, oft mit dekorativen Maserungen. Verwendung: M√∂bel, Furniere, Intarsien, edle Ausstattungen. Funfact: Walnuss (Nussbaum) war schon in der Renaissance sehr gesch√§tzt und zierte viele k√∂nigliche M√∂belst√ºcke.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/nussbaum_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/nussbaum_2.jpg?raw=true" },
             "Douglasie": { info: `Douglasie (DO) Douglasienholz ist robust, witterungsbest√§ndig und h√§ufig im Au√üenbau eingesetzt. Die Struktur ist klar erkennbar ‚Äì deutliche Jahresringe mit Transition zwischen Fr√ºh‚Äë und Sp√§tholz. Verwendung: Bauholz, Fassaden, Dach, M√∂bel im Au√üenbereich. Funfact: Die Douglasie stammt urspr√ºnglich aus Nordamerika, ist aber auch in Europa weit verbreitet und wird gro√ügezogen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/douglasie_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/douglasie_2.jpg?raw=true" },
             "Zeder": { info: `Zeder (ZE) Zedernholz duftet angenehm und besitzt von Natur aus eine Resistenz gegen Insektenbefall und Feuchtigkeit. Die Struktur ist fein mit gleichm√§√üigen Poren ‚Äì kein starker Kontrast zwischen Fr√ºh- und Sp√§tholz. Verwendung: M√∂bel, Fassaden, Innenraum, Schr√§nke. Funfact: Zedernholz wird oft in Kleiderschr√§nken eingesetzt, weil es den unverwechselbaren Duft und Insektenabwehr besitzt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zeder_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zeder_2.jpg?raw=true" },
             "Mahagoni": { info: `Mahagoni (MA) Mahagoni ist ein tropisches Edelholz mit hoher Dauerhaftigkeit und edler Farbe. Es ist zerstreutporig ‚Äì Poren gleichm√§√üig verteilt und oft mit dekorativer Kernholzstruktur. Verwendung: M√∂bel, Fenster, Luxusausstattung, Bootsbau. Funfact: In manchen L√§ndern ist Mahagoni wegen seiner Seltenheit streng reguliert und unterliegt Artenschutzbestimmungen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/mahagoni_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/mahagoni_2.jpg?raw=true" },
             "Teak": { info: `Teak (TE) Teak ist extrem witterungsbest√§ndig durch hohen √ñl- und Harzgehalt ‚Äì ideal f√ºr Au√üenm√∂bel und Schiffsbau. Die Struktur ist fein zerstreutporig, mit dekorativem Erscheinungsbild und gleichm√§√üiger Porenverteilung. Verwendung: Gartenm√∂bel, Terrassen, Boote, Fenster, Au√üenbereich. Funfact: Teakholz war fr√ºher f√ºr den Bau von Kriegsschiffen sehr gefragt wegen seiner Dauerhaftigkeit und Wasserbest√§ndigkeit.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/teak_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/teak_2.jpg?raw=true" },
             "Bambus": { info: `Bambus (BA) Bambus ist botanisch gesehen kein Holz, sondern ein Gras ‚Äì dennoch extrem stabil und vielseitig verwendbar. Die Struktur ist r√∂hrenartig und weist keine klassischen Poren wie Harth√∂lzer auf. Verwendung: Fu√üb√∂den, M√∂bel, Treppen, nachhaltiger Bau. Funfact: Bambus w√§chst so schnell, dass einzelne Stangen innerhalb weniger Monate √ºber einen Meter wachsen k√∂nnen.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/bambus_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/bambus_2.jpg?raw=true" },
             "Pappel": { info: `Pappel (PA) Pappelholz ist sehr leicht und weich ‚Äì weniger tragf√§hig, aber gut bearbeitbar. Feine Struktur, fast keine gro√üen Poren ‚Äì Jahresringe nur dezent sichtbar. Verwendung: Leichtbau, Verpackungen, M√∂bel mit geringer Belastung. Funfact: Pappelholz wird oft f√ºr Modellbau oder Flugzeuginnenr√§ume verwendet, wo Leichtigkeit z√§hlt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/pappel_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/pappel_2.jpg?raw=true" },
             "Weide": { info: `Weide (WE) Weidenholz ist elastisch und biegsam ‚Äì traditionell f√ºr Flechtarbeiten und K√∂rbe verwendet. Die Struktur ist fein zerstreutporig, Poren kaum markant. Verwendung: Flechtwerk, Gartenbau, leichte M√∂bel. Funfact: Weidenruten werden seit Jahrhunderten f√ºr Korbgeflechte, Z√§une und Rankhilfen genutzt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/weide_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/weide_2.jpg?raw=true" },
             "Linde": { info: `Linde (LI) Lindenholz ist weich, homogen und gut schnitzbar ‚Äì ideal f√ºr feine Holzarbeiten. Fein zerstreutporig und gleichm√§√üig, ohne gro√üen Porenkontrast. Verwendung: Intarsien, geschnitzte Dekors, M√∂bel, Modellbau. Funfact: Lindenholz war traditionell das Holz der Bildhauer und Orgelbauer im Mittelalter.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/linde_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/linde_2.jpg?raw=true" },
             "Ulme": { info: `Ulme (UL) Ulmenholz ist z√§h und eher hart ‚Äì fr√ºher oft f√ºr M√∂bel und Reparaturen verwendet. Ringporig mit markanten Poren und gelegentlichem unruhigem Faserverlauf. Verwendung: M√∂bel, Innenausbau, Reparaturholz. Funfact: Ulmenholz hat fr√ºher im Wagen- und M√∂belbau Bedeutung gehabt, besonders dort, wo Biegung gefragt war.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ulme_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ulme_2.jpg?raw=true" },
             "Kastanie": { info: `Kastanie (KA) Kastanienholz ist √§hnlich der Eiche wetterbest√§ndig, mit warmem Farbton und markanter Struktur. Ringporig mit klar sichtbaren Jahresringen und deutlichem √úbergang. Verwendung: Au√üenbau, M√∂bel, Balken, Gartenholz. Funfact: Kastanienholz wurde oft in historischen Bauwerken als wetterbest√§ndige Alternative zur Eiche verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kastanie_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/kastanie_2.jpg?raw=true" },
             "Robinie": { info: `Robinie (RO) Robinienholz ist eines der h√§rtesten europ√§ischen H√∂lzer und sehr dauerhaft im Freien. Ringporig mit feinen Poren und schmalem √úbergang ‚Äì die Struktur ist weniger kontrastreich. Verwendung: Gartenholz, Terrassen, Balken, Z√§une. Funfact: Robinie wird oft als ‚Äûeurop√§isches Teak‚Äú genannt, weil es √§hnliche Eigenschaften wie Tropenholz zeigt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/robinie_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/robinie_2.jpg?raw=true" },
             "Hemlock": { info: `Hemlock (HE) Hemlock ist ein n√∂rdliches Nadelholz mit feiner Struktur, weich und gleichm√§√üig. Die Porenstruktur √§hnelt einfacher Zellstruktur; Jahresringe dezent sichtbar. Verwendung: Innenausbau, Paneele, Bauholz. Funfact: Hemlock wird oft im M√∂bel- und Leichtbau verwendet, wenn gutes Verh√§ltnis zwischen Gewicht und Stabilit√§t gefragt ist.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hemlock_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hemlock_2.jpg?raw=true" },
             "Zypresse": { info: `Zypresse (ZY) Zypressenholz duftet gut und ist nat√ºrlich resistent gegen Feuchtigkeit und Sch√§dlinge. Die Struktur ist fein und gleichm√§√üig, mit moderatem Porencharakter. Verwendung: Au√üen- und Gartenholz, M√∂bel, Fassaden. Funfact: Zypresse wurde in mediterranen Regionen oft zur Holzverkleidung von Kirchen und Tempeln verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zypresse_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zypresse_2.jpg?raw=true" },
             "Redwood": { info: `Redwood (RW) Redwood ist ein leichtes Tropenholz mit guter Dauerhaftigkeit und dekorativer Farbe. Zerstreutporig mit feiner Textur, Poren gleichm√§√üig verteilt. Verwendung: Au√üenholz, Z√§une, Gartenkonstruktionen. Funfact: Der K√ºstenmammutbaum (Redwood) z√§hlt zu den h√∂chsten B√§umen der Welt.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/redwood_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/redwood_2.jpg?raw=true" },
             "Hickory": { info: `Hickory (HI) Hickory ist ein ausgesprochen z√§hes und hartes Holz ‚Äì ideal f√ºr stark beanspruchte Teile. Ringporig mit ausgepr√§gten Poren im Fr√ºhholz und klaren Jahresringen. Verwendung: Werkzeugstiele, Sportger√§te, M√∂bel mit hoher Belastung. Funfact: Hickory war traditionell Material f√ºr Peitschen, Wurfst√∂cke und Arbeitsger√§te.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hickory_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/hickory_2.jpg?raw=true" },
             "Wenge": { info: `Wenge (WE-NE) Wenge ist ein dunkles Tropenholz mit hoher H√§rte und dekorativer Maserung. Zerstreutporig mit feinen Poren ‚Äì oft Streifenzeichnung sichtbar. Verwendung: Luxusm√∂bel, Parkett, Furniere. Funfact: Wegen seiner tiefen, dunklen Farbe wird Wenge oft in Kontrasten zu hellem Holz kombiniert.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/wenge_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/wenge_2.jpg?raw=true" },
             "Zebrano": { info: `Zebrano (ZE-RA) Zebrano zeichnet sich durch seine markante Streifenoptik aus ‚Äì dekorativ und auff√§llig. Die Porenstruktur ist zerstreutporig, oft mit deutlichem Maserungseffekt. Verwendung: Designm√∂bel, Furniere, Dekorationen. Funfact: Zebrano wird oft f√ºr luxuri√∂se Intarsien und Furnierarbeiten verwendet.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zebrano_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/zebrano_2.jpg?raw=true" },
             "Palisander": { info: `Palisander (PA) Palisanderholz ist dekorativ, fest und langlebig ‚Äì mit attraktiven Farbt√∂nen. Zerstreutporig mit feiner Struktur und gleichm√§√üiger Porenverteilung. Verwendung: Gitarren, M√∂bel, Furniere. Funfact: Palisanderholz war fr√ºher oft exklusiv f√ºr edle Musikinstrumente und Intarsien reserviert.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/palisander_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/palisander_2.jpg?raw=true" },
             "Ebenholz": { info: `Ebenholz (EB) Ebenholz ist eines der h√§rtesten H√∂lzer ‚Äì fast tiefschwarz und sehr dicht. Zerstreutporig mit extrem feinen Poren, kaum sichtbar ‚Äì Porenstruktur sehr fein. Verwendung: Klaviertasten, Intarsien, Luxusdekore. Funfact: Ebenholz wurde im alten √Ñgypten f√ºr Statuetten und Schmuckst√ºcke verwendet ‚Äì wegen seiner tiefen Farbe und Seltenheit.`, bildBaum: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ebenholz_1.jpg?raw=true", bildQuerschnitt: "https://github.com/aufdemholzweg/holzquartett/blob/main/images/ebenholz_2.jpg?raw=true" }
        };

        const reflectionQuestions = [
            "Stell dir vor, du sollst einen stabilen und langlebigen Esstisch f√ºr eine Familie entwerfen. Welche Holzarten aus dem Spiel w√§ren geeignet und warum?",
            "Welches Holz w√ºrdest du f√ºr Gartenm√∂bel w√§hlen, die ganzj√§hrig drau√üen stehen? Begr√ºnde mit Dauerhaftigkeitsklasse und Witterungsbest√§ndigkeit.",
            "Eine K√ºchenarbeitsplatte muss schnittfest und widerstandsf√§hig sein. Welche Eigenschaften spielen hier die gr√∂√üte Rolle?",
            "F√ºr einen stark beanspruchten Dielenboden: Welche H√∂lzer w√§ren aus deiner Sicht am geeignetsten und warum?",
            "Du sollst den Korpus einer Akustikgitarre bauen. Worauf achtest du bei der Auswahl der Holzart?",
            "Fenster sind st√§ndig wechselnder Luftfeuchtigkeit ausgesetzt. Welche H√∂lzer aus dem Spiel w√§ren eine gute Wahl?",
            "F√ºr ein Modellflugzeug oder ein leichtes Regal: Welche leichten H√∂lzer kommen infrage, und welche Nachteile haben sie?",
            "Robinie und L√§rche sind beide f√ºr den Au√üenbereich beliebt. In welchen F√§llen w√ºrdest du welche w√§hlen?",
            "Du m√∂chtest einen gebogenen Handlauf herstellen. Welche H√∂lzer lassen sich gut biegen?",
            "Vergleiche die Rohdichte und den E-Modul von Fichte und Eiche. Was bedeutet das f√ºr die Verwendung im Bau?",
            "H√∂lzer mit hohem Quell- und Schwindma√ü sind im Innenausbau problematisch. Welche Alternativen gibt es?",
            "Ein Hammerstiel muss extrem bruchfest und elastisch sein. Welche Holzarten sind daf√ºr klassisch und warum?",
            "Bei Eichenholz kann es in Verbindung mit Eisen zu Verf√§rbungen kommen. In welchem Bauteil w√§re das kritisch?",
            "Weiche H√∂lzer wie Fichte oder Kiefer sind leicht zu bearbeiten, aber weniger druckfest. Wo siehst du dennoch sinnvolle Einsatzgebiete?",
            "F√ºr die Herstellung von dekorativen Furnieren werden oft sehr markante H√∂lzer genommen. Welche aus dem Spiel w√§ren geeignet?",
            "Nenne drei heimische H√∂lzer und ordne sie nach ihrer durchschnittlichen Rohdichte.",
            "Holz ist ein wichtiger CO‚ÇÇ-Speicher. Erkl√§re kurz, warum der Einsatz von langlebigen Holzprodukten √∂kologisch sinnvoll ist.",
            "Was bedeuten Siegel wie FSC oder PEFC im Zusammenhang mit dem Holzhandel?",
            "Teak hat eine exzellente Dauerhaftigkeit (DK 1). Warum ist es trotzdem nicht immer die beste Wahl?",
            "Bambus ist botanisch gesehen ein Gras, wird aber wie Holz eingesetzt. Wo liegen Chancen und Grenzen?",
            "Was k√∂nntest du aus einem alten Eichenbalken (z. B. aus einem Fachwerk) noch herstellen, sodass die Eigenschaften sinnvoll genutzt werden?",
            "Du m√∂chtest ein M√∂belst√ºck mit einem starken Hell-Dunkel-Kontrast bauen. Welche zwei H√∂lzer aus dem Spiel w√ºrdest du kombinieren?",
            "H√∂lzer wie Eiche oder Esche haben eine charakteristische Maserung. In welcher Situation w√§re eine ruhige, gleichm√§√üige Struktur besser?",
            "Stell dir vor, du entwirfst ein Kinderspielzeug aus Holz. Welche Kriterien spielen bei der Holzwahl eine Rolle?",
            "Einige H√∂lzer wie Kirsche oder L√§rche dunkeln nach. Wie kannst du diese Eigenschaft gestalterisch nutzen?",
            "F√ºr ein modernes, minimalistisches M√∂belst√ºck werden oft helle, gleichm√§√üige H√∂lzer gew√§hlt. Welche bieten sich an?",
            "Welches Holz w√ºrdest du f√ºr den Bau einer rustikalen Almh√ºtte w√§hlen und warum?",
            "Du planst ein Sch√ºlerprojekt, bei dem die Auszubildenden Holzarten erkennen und zuordnen sollen. Welche Spielvariante aus deinem Quartett w√§re geeignet?",
            "Ein Kunde w√ºnscht sich f√ºr seine Terrasse ein Holz mit m√∂glichst wenig Splitterneigung. Welche Arten w√ºrdest du eher meiden?",
            "Welche Eigenschaft einer Holzart ist aus deiner Sicht am wichtigsten, wenn das Bauteil sp√§ter im Au√üenbereich eingesetzt wird?",
            "Wenn du eine neue Kategorie f√ºr dein Quartett hinzuf√ºgen w√ºrdest ‚Äì welche w√§re das und warum?"
        ];

        const attributeInfo = {
            dk: {icon: 'üõ°Ô∏è', name: 'Dauerhaftigkeit (DK)', color: 'blue'},
            haerte: {icon: 'üíé', name: 'Druckfestigkeit (N/mm¬≤)', color: 'blue'},
            quellenSchwindenRadial: {icon: '‚ÜîÔ∏è', name: 'Quellen/Schwinden (%)', color: 'blue'},
            dichte: {icon: '‚öñÔ∏è', name: 'Rohdichte (kg/m¬≥)', color: 'blue'},
            gewicht: {icon: 'üèãÔ∏è', name: 'E-Modul (N/mm¬≤)', color: 'blue'}
        };

        let aiGame = { playerName: '', playerCards: [], aiCards: [], currentPlayerCard: null, currentAiCard: null, roundInProgress: false, turn: 'player' };

        document.addEventListener('DOMContentLoaded', async () => {
            try { await signInAnonymously(auth); } catch (e) { console.error("Firebase Auth Error:", e); }
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    localPlayerId = user.uid;
                    const urlParams = new URLSearchParams(window.location.search);
                    const gameIdFromUrl = urlParams.get('game');
                    if (gameIdFromUrl) {
                        gameId = gameIdFromUrl;
                        gameMode = 'multiplayer';
                        window.showNamePrompt('join');
                    }
                }
            });
        });

        window.addEventListener('beforeunload', async () => {
            if (gameMode === 'multiplayer' && gameId && localPlayerId) {
                const gameRef = doc(db, "games", gameId);
                const playerStatusPath = `players.${localPlayerId}.status`;
                await updateDoc(gameRef, { [playerStatusPath]: "offline" }).catch(() => {});
            }
        });

        window.showNamePrompt = (mode) => {
            document.getElementById('setupModal').classList.add('hidden');
            const nameModal = document.getElementById('nameModal');
            nameModal.classList.remove('hidden');
            const nameSubmitButton = document.getElementById('nameSubmitButton');
            const newButton = nameSubmitButton.cloneNode(true);
            nameSubmitButton.parentNode.replaceChild(newButton, nameSubmitButton);
            newButton.addEventListener('click', () => {
                const playerName = document.getElementById('playerName').value.trim();
                if (!playerName) { alert('Bitte gib deinen Namen ein!'); return; }
                nameModal.classList.add('hidden');
                if (mode === 'ai') { gameMode = 'ai'; startGameAI(playerName); }
                else if (mode === 'multiplayer') { gameMode = 'multiplayer'; createGame(playerName); }
                else if (mode === 'join') { joinGame(gameId, playerName); }
            });
        };

        window.copyShareLink = async () => {
            const linkInput = document.getElementById('shareLink');
            try { await navigator.clipboard.writeText(linkInput.value); }
            catch (err) { linkInput.select(); document.execCommand('copy'); }
            hasCopiedShareLink = true;
            const statusEl = document.getElementById('lobbyStatus');
            if (statusEl) statusEl.textContent = 'Link kopiert. Warte auf Mitspieler...';
            if (localGameState && (localGameState.status === 'playing' || localGameState.status === 'finished')) {
                document.getElementById('multiplayerLobbyModal').classList.add('hidden');
                document.getElementById('gameContainer').classList.remove('hidden');
                updateMultiplayerUI(localGameState);
            }
        };

        async function createGame(playerName) {
            const lobbyModal = document.getElementById('multiplayerLobbyModal');
            lobbyModal.classList.remove('hidden');
            hasCopiedShareLink = false;
            gameId = Math.random().toString(36).substring(2, 8).toUpperCase();
            const shareLinkInput = document.getElementById('shareLink');
            const baseUrl = window.location.href.split('?')[0];
            const inviteUrl = `${baseUrl}?game=${gameId}`;
            shareLinkInput.value = inviteUrl;

            // NEU: QR-Code direkt erzeugen
            if (window.generateQRCode) {
                window.generateQRCode(inviteUrl);
            }

            const gameRef = doc(db, "games", gameId);
            const initialGameData = {
                gameId: gameId,
                status: 'waiting',
                playerIds: [localPlayerId],
                players: {
                    [localPlayerId]: { name: playerName, cards: [], status: 'online' }
                },
                createdAt: serverTimestamp()
            };
            try {
                await setDoc(gameRef, initialGameData);
                listenToGameChanges();
            } catch (error) {
                console.error("Error creating game:", error);
                alert("Fehler beim Erstellen des Spiels.");
            }
        }

        async function joinGame(gameIdToJoin, playerName) {
            const gameRef = doc(db, "games", gameIdToJoin);
            try {
                const gameSnap = await getDoc(gameRef);
                if (gameSnap.exists() && gameSnap.data().status === 'waiting' && gameSnap.data().playerIds.length === 1) {
                    document.getElementById('lobbyTitle').textContent = "Spiel wird beigetreten...";
                    document.getElementById('lobbyText').textContent = "Moment, die Karten werden gemischt.";
                    document.getElementById('multiplayerLobbyModal').classList.remove('hidden');
                    hasCopiedShareLink = true;

                    // Link + QR auch beim Beitritt anzeigen
                    const shareLinkInput = document.getElementById('shareLink');
                    const currentUrl = window.location.href;
                    if (shareLinkInput) {
                        shareLinkInput.value = currentUrl;
                    }
                    if (window.generateQRCode) {
                        window.generateQRCode(currentUrl);
                    }

                    const shuffledCards = shuffleArray([...woodCards]);
                    const player1Id = gameSnap.data().playerIds[0];
                    const player1Cards = shuffledCards.slice(0, 15);
                    const player2Cards = shuffledCards.slice(15, 30);
                    const gameUpdateData = {
                        status: 'playing',
                        playerIds: [player1Id, localPlayerId],
                        [`players.${localPlayerId}`]: { name: playerName, cards: player2Cards, status: 'online' },
                        [`players.${player1Id}.cards`]: player1Cards,
                        turn: player1Id,
                        currentCards: {
                            [player1Id]: player1Cards[0],
                            [localPlayerId]: player2Cards[0]
                        },
                        lastResult: null,
                        lastActivity: serverTimestamp()
                    };
                    await updateDoc(gameRef, gameUpdateData);
                    listenToGameChanges();
                } else {
                    alert("Spiel nicht gefunden, bereits voll oder beendet.");
                    window.location.search = '';
                }
            } catch (error) {
                console.error("Error joining game:", error);
                alert("Fehler beim Beitreten zum Spiel.");
                window.location.search = '';
            }
        }

        function listenToGameChanges() {
            if (!gameId) return;
            const gameRef = doc(db, "games", gameId);
            unsubscribeGame = onSnapshot(gameRef, (docSnap) => {
                if (!docSnap.exists()) {
                    if (gameMode === 'multiplayer') {
                        alert("Das Spiel wurde beendet oder gel√∂scht.");
                        resetGame();
                    }
                    return;
                }
                const gameData = docSnap.data();
                localGameState = gameData;

                if (gameData.status === 'playing' || gameData.status === 'finished') {
                    if (hasCopiedShareLink || (gameData.playerIds.includes(localPlayerId) && gameData.playerIds.length === 2)) {
                        document.getElementById('multiplayerLobbyModal').classList.add('hidden');
                        document.getElementById('gameContainer').classList.remove('hidden');
                        updateMultiplayerUI(gameData);
                    } else if (!hasCopiedShareLink && gameData.playerIds.length === 2) {
                        const statusEl = document.getElementById('lobbyStatus');
                        if (statusEl) statusEl.textContent = 'Mitspieler ist beigetreten! Klicke ‚ÄûLink kopieren‚Äú, um zu starten.';
                    }
                } else if (gameData.status === 'waiting') {
                    document.getElementById('multiplayerLobbyModal').classList.remove('hidden');
                    document.getElementById('gameContainer').classList.add('hidden');
                }

                const opponentId = gameData.playerIds?.find(id => id !== localPlayerId);
                if (opponentId && gameData.players[opponentId]?.status === 'offline') {
                    // optional: Gegner offline
                }
            }, (error) => {
                console.error("Error listening to game changes:", error);
            });
        }

        function updateMultiplayerUI(gameData) {
            if (!gameData || !gameData.players || !gameData.playerIds) {
                console.error("Incomplete game data received:", gameData);
                return;
            }
            const opponentId = gameData.playerIds.find(id => id !== localPlayerId);
            document.getElementById('playerNameDisplay').textContent = gameData.players[localPlayerId]?.name || 'Du';
            document.getElementById('playerCards').textContent = gameData.players[localPlayerId]?.cards?.length ?? '?';
            if (opponentId && gameData.players[opponentId]) {
                document.getElementById('opponentNameDisplay').textContent = gameData.players[opponentId].name;
                document.getElementById('aiCards').textContent = gameData.players[opponentId]?.cards?.length ?? '?';
            } else {
                document.getElementById('opponentNameDisplay').textContent = "Wartet...";
                document.getElementById('aiCards').textContent = '-';
            }
            updateStatusBar(gameData.players[localPlayerId]?.cards?.length ?? 0, gameData.players[opponentId]?.cards?.length ?? 0);
            displayMultiplayerCards(gameData);

            const turnIndicator = document.getElementById('turnIndicator');
            const attributeSelection = document.getElementById('attributeSelection');
            const resultDisplay = document.getElementById('resultDisplay');
            const nextRoundBtn = document.getElementById('nextRoundButton');
            turnIndicator.classList.remove('hidden');

            if (gameData.lastResult) {
                if (!roundSoundPlayed) {
                    roundSoundPlayed = true;
                    playSound(sounds.flip);
                    if (gameData.lastResult.winnerId === localPlayerId) {
                        playSound(sounds.win);
                    }
                }
                attributeSelection.classList.add('hidden');
                resultDisplay.classList.remove('hidden');
                nextRoundBtn.classList.remove('hidden');

                const { winnerId, attribute, values } = gameData.lastResult;
                const opponentActualId = opponentId || 'opponent';
                const winnerName = winnerId === localPlayerId ? 'Du' : (winnerId === 'tie' ? '' : gameData.players[winnerId]?.name || 'Gegner');
                let resultText = winnerId === 'tie' ? `ü§ù Unentschieden!` : `üéâ ${winnerName} gewinnt!`;
                if (winnerId !== localPlayerId && winnerId !== 'tie') {
                    resultText = `üòû ${winnerName} gewinnt!`;
                }
                let resultDetailsText = `${attributeInfo[attribute]?.name.split(' (')[0] || attribute}: ${values[localPlayerId]?.toLocaleString('de-DE') ?? '?'} vs ${values[opponentActualId]?.toLocaleString('de-DE') ?? '?'}`;
                document.getElementById('resultText').textContent = resultText;
                document.getElementById('resultDetails').textContent = resultDetailsText;

                const attributeIndex = Object.keys(attributeInfo).indexOf(attribute);
                if (attributeIndex !== -1) {
                    const playerRow = document.querySelector(`#playerCard .space-y-1 > *:nth-child(${attributeIndex + 1})`);
                    const opponentRow = document.querySelector(`#aiCard .space-y-1 > *:nth-child(${attributeIndex + 1})`);
                    const highlightClass = 'bg-yellow-200';
                    const playerCurrentBg = playerRow?.classList.toString().match(/bg-(amber|gray|yellow)-[0-9]+/)?.[0];
                    const opponentCurrentBg = opponentRow?.classList.toString().match(/bg-(amber|gray|yellow)-[0-9]+/)?.[0];
                    if (playerRow) {
                        if (playerCurrentBg) playerRow.classList.remove(playerCurrentBg);
                        playerRow.classList.add(highlightClass);
                    }
                    if (opponentRow) {
                        if (opponentCurrentBg) opponentRow.classList.remove(opponentCurrentBg);
                        opponentRow.classList.add(highlightClass);
                    }
                }

                const playerCardElement = document.getElementById('playerCard')?.querySelector('.card-front');
                const aiCardElement = document.getElementById('aiCard')?.querySelector('.card-front');
                const statusBarElement = document.getElementById('statusBar');
                playerCardElement?.classList.remove('animate-glow-win', 'animate-glow-lose');
                aiCardElement?.classList.remove('animate-glow-win', 'animate-glow-lose');

                if (winnerId === localPlayerId) {
                    playerCardElement?.classList.add('animate-glow-win');
                    triggerWinStarAnimation();
                } else if (winnerId !== 'tie') {
                    playerCardElement?.classList.add('animate-glow-lose');
                    aiCardElement?.classList.add('animate-glow-win');
                }

                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                roundSoundPlayed = false;
                resultDisplay.classList.add('hidden');
                nextRoundBtn.classList.add('hidden');
                if (gameData.turn === localPlayerId) {
                    turnIndicator.textContent = "Du bist am Zug!";
                    turnIndicator.className = 'text-sm font-semibold p-1 text-green-600';
                    attributeSelection.classList.remove('hidden');
                } else {
                    turnIndicator.textContent = `${gameData.players[gameData.turn]?.name || 'Gegner'} ist am Zug...`;
                    turnIndicator.className = 'text-sm font-semibold p-1 text-gray-500';
                    attributeSelection.classList.add('hidden');
                }
            }

            if (gameData.status === 'finished') { endGame(); }
        }

        function updateStatusBar(playerCount, opponentCount) {
            const total = playerCount + opponentCount;
            const playerPercentage = total > 0 ? (playerCount / total) * 100 : 50;
            const statusBar = document.getElementById('statusBar');
            if (statusBar) {
                statusBar.style.width = `${playerPercentage}%`;
                let color = '#f59e0b';
                if (playerPercentage < 25) color = '#ef4444';
                else if (playerPercentage < 45) color = '#f97316';
                else if (playerPercentage > 75) color = '#22c55e';
                else if (playerPercentage > 55) color = '#84cc16';
                statusBar.style.backgroundColor = color;
            }
        }

        function displayMultiplayerCards(gameData) {
            if (!gameData.currentCards || !gameData.playerIds) return;
            const opponentId = gameData.playerIds.find(id => id !== localPlayerId);
            const playerCardContainer = document.getElementById('playerCard');
            const aiCardContainer = document.getElementById('aiCard');
            playerCardContainer.innerHTML = '';
            aiCardContainer.innerHTML = '';
            const showOpponentCardFace = !!gameData.lastResult;
            if (gameData.currentCards[localPlayerId]) {
                const playerCard = createCard(gameData.currentCards[localPlayerId], true, true);
                playerCardContainer.appendChild(playerCard);
            } else {
                playerCardContainer.innerHTML = `<div class="card-front bg-gray-200 ...">Warte auf Karte...</div>`;
            }
            if (opponentId && gameData.currentCards[opponentId]) {
                const aiCard = createCard(gameData.currentCards[opponentId], showOpponentCardFace, false);
                aiCardContainer.appendChild(aiCard);
            } else if (gameData.playerIds.length < 2) {
                aiCardContainer.innerHTML = `<div class="card-front bg-gray-200 ...">Wartet auf Spieler 2...</div>`;
            } else {
                const dummyOpponentCardData = { name: "Gegner", dk: '?', haerte: '?', quellenSchwindenRadial: '?', dichte: '?', gewicht: '?' };
                const aiCard = createCard(dummyOpponentCardData, false, false);
                aiCardContainer.appendChild(aiCard);
            }
        }

        async function multiplayerSelectAttribute(attribute) {
            if (!localGameState || localGameState.turn !== localPlayerId || localGameState.lastResult || !attributeInfo[attribute]) return;
            const playerCard = localGameState.currentCards?.[localPlayerId];
            const opponentId = localGameState.playerIds?.find(id => id !== localPlayerId);
            if (!opponentId || !localGameState.currentCards?.[opponentId]) {
                console.warn("Opponent or opponent card not ready.");
                return;
            }
            const opponentCard = localGameState.currentCards[opponentId];
            const playerValue = playerCard?.[attribute];
            const opponentValue = opponentCard?.[attribute];
            if (playerValue === undefined || opponentValue === undefined) {
                console.error("Attribute value missing for comparison:", attribute);
                return;
            }
            let playerWins;
            if (attribute === 'quellenSchwindenRadial' || attribute === 'dk') {
                if (playerValue < opponentValue) playerWins = true;
                else if (opponentValue < playerValue) playerWins = false;
                else playerWins = 'tie';
            } else {
                if (playerValue > opponentValue) playerWins = true;
                else if (opponentValue > playerValue) playerWins = false;
                else playerWins = 'tie';
            }
            const winnerId = playerWins === 'tie' ? 'tie' : (playerWins ? localPlayerId : opponentId);
            const gameUpdate = {
                lastResult: {
                    winnerId,
                    attribute,
                    values: { [localPlayerId]: playerValue, [opponentId]: opponentValue }
                },
                lastActivity: serverTimestamp()
            };
            try {
                await updateDoc(doc(db, "games", gameId), gameUpdate);
            } catch (error) {
                console.error("Error selecting attribute:", error);
            }
        }

        async function multiplayerNextRound() {
            const pf = document.getElementById('playerCard')?.querySelector('.card-front');
            if (pf) pf.classList.remove('animate-glow-win', 'animate-glow-lose');
            const af = document.getElementById('aiCard')?.querySelector('.card-front');
            if (af) af.classList.remove('animate-glow-win', 'animate-glow-lose');
            document.querySelectorAll('#playerCard .space-y-1 > *, #aiCard .space-y-1 > *').forEach(el => {
                el.classList.remove('bg-yellow-200', 'bg-gray-300');
            });
            if (!localGameState || !localGameState.lastResult || !gameId) {
                console.log("Next round conditions not met.");
                return;
            }
            try {
                const currentGameState = localGameState;
                if (!currentGameState.lastResult) {
                    console.log("Result already processed, likely by other player.");
                    return;
                }
                const currentWinnerId = currentGameState.lastResult.winnerId;
                const [player1Id, player2Id] = currentGameState.playerIds;
                if (!currentGameState.players?.[player1Id]?.cards || !currentGameState.players?.[player2Id]?.cards) {
                    console.error("Player card data missing in game state for next round.");
                    return;
                }
                let p1Cards = [...currentGameState.players[player1Id].cards];
                let p2Cards = [...currentGameState.players[player2Id].cards];
                if (p1Cards.length === 0 && p2Cards.length === 0 && currentGameState.status !== 'finished') {
                    console.error("Both players have no cards, but game not finished. Setting to finished.");
                    await updateDoc(doc(db, "games", gameId), { status: 'finished', lastResult: null });
                    return;
                }
                const p1Card = p1Cards.shift();
                const p2Card = p2Cards.shift();
                if (currentWinnerId === player1Id) {
                    if (p1Card) p1Cards.push(p1Card);
                    if (p2Card) p1Cards.push(p2Card);
                } else if (currentWinnerId === player2Id) {
                    if (p1Card) p2Cards.push(p1Card);
                    if (p2Card) p2Cards.push(p2Card);
                } else {
                    if (p1Card) p1Cards.push(p1Card);
                    if (p2Card) p2Cards.push(p2Card);
                }
                if (p1Cards.length === 0 || p2Cards.length === 0) {
                    await updateDoc(doc(db, "games", gameId), {
                        status: 'finished',
                        'players': {
                            [player1Id]: { ...currentGameState.players[player1Id], cards: p1Cards },
                            [player2Id]: { ...currentGameState.players[player2Id], cards: p2Cards }
                        },
                        currentCards: { [player1Id]: null, [player2Id]: null },
                        lastResult: null
                    });
                    return;
                }
                const nextTurn = currentWinnerId === 'tie' ? currentGameState.turn : currentWinnerId;
                const gameUpdate = {
                    'lastResult': null,
                    'turn': nextTurn,
                    'players': {
                        [player1Id]: { ...currentGameState.players[player1Id], cards: p1Cards },
                        [player2Id]: { ...currentGameState.players[player2Id], cards: p2Cards }
                    },
                    'currentCards': {
                        [player1Id]: p1Cards[0] || null,
                        [player2Id]: p2Cards[0] || null
                    },
                    'lastActivity': serverTimestamp()
                };
                await updateDoc(doc(db, "games", gameId), gameUpdate);
            } catch (error) {
                console.error("Error processing multiplayer next round:", error);
            }
        }

        function startGameAI(playerName) {
            aiGame.playerName = playerName;
            const shuffled = shuffleArray([...woodCards]);
            aiGame.playerCards = shuffled.slice(0, 15);
            aiGame.aiCards = shuffled.slice(15, 30);
            aiGame.currentPlayerCard = aiGame.playerCards[0];
            aiGame.currentAiCard = aiGame.aiCards[0];
            aiGame.turn = 'player';
            document.getElementById('playerNameDisplay').textContent = playerName;
            document.getElementById('opponentNameDisplay').textContent = "Computer";
            document.getElementById('playerCards').textContent = aiGame.playerCards.length;
            document.getElementById('aiCards').textContent = aiGame.aiCards.length;
            updateStatusBar(aiGame.playerCards.length, aiGame.aiCards.length);
            document.getElementById('gameContainer').classList.remove('hidden');
            displayAIGameCards();
        }

        function displayAIGameCards(showAiCard = false) {
            const playerCardContainer = document.getElementById('playerCard');
            const aiCardContainer = document.getElementById('aiCard');
            playerCardContainer.innerHTML = '';
            aiCardContainer.innerHTML = '';
            const playerCard = createCard(aiGame.currentPlayerCard, true, true, 'ai');
            const aiCard = createCard(aiGame.currentAiCard, showAiCard, false, 'ai');
            playerCardContainer.appendChild(playerCard);
            aiCardContainer.appendChild(aiCard);
            const turnIndicator = document.getElementById('turnIndicator');
            const attributeSelection = document.getElementById('attributeSelection');
            const resultDisplay = document.getElementById('resultDisplay');
            const nextRoundBtn = document.getElementById('nextRoundButton');
            turnIndicator.classList.remove('hidden');
            resultDisplay.classList.add('hidden');
            nextRoundBtn.classList.add('hidden');
            if (aiGame.turn === 'player') {
                turnIndicator.textContent = "Du bist am Zug!";
                turnIndicator.className = 'text-sm font-semibold p-1 text-green-600';
                attributeSelection.classList.remove('hidden');
            } else {
                turnIndicator.textContent = "Computer ist am Zug...";
                turnIndicator.className = 'text-sm font-semibold p-1 text-gray-500';
                attributeSelection.classList.add('hidden');
            }
        }

        function createCard(cardData, showFront = true, isPlayer = true, mode = 'multi') {
            const card = document.createElement('div');
            card.className = 'relative w-full h-full card-3d';
            if (!showFront) card.classList.add('card-flipped');
            const front = document.createElement('div');
            front.className = 'card-front bg-white/90 rounded-2xl shadow-xl border border-amber-100 p-3 flex flex-col justify-between h-full relative card-background';
            const back = document.createElement('div');
            back.className = 'card-back rounded-2xl shadow-xl border border-amber-100';
            front.innerHTML = `
                <div class="flex items-center justify-between mb-1">
                    <div>
                        <h2 class="text-sm font-bold text-amber-900">${cardData.name}</h2>
                        <p class="text-[0.6rem] text-gray-600">Holzart</p>
                    </div>
                    <button type="button" onclick="window.openInfoModal('${cardData.name.replace(/'/g, "\'")}')" class="text-xs bg-white/80 hover:bg-white text-amber-700 px-2 py-1 rounded-full border border-amber-100 shadow-sm transition hover-lift">
                        Info
                    </button>
                </div>
                <div class="space-y-1 mt-0.5">
                    <div class="flex items-center justify-between bg-amber-50/90 rounded-lg px-2 py-1 text-xs shadow-sm">
                        <span class="flex items-center gap-1">
                            <span>üõ°Ô∏è</span>
                            <span>Dauerhaftigkeit</span>
                        </span>
                        <span class="font-semibold">${cardData.dk}</span>
                    </div>
                    <div class="flex items-center justify-between bg-white/90 rounded-lg px-2 py-1 text-xs shadow-sm">
                        <span class="flex items-center gap-1">
                            <span>üíé</span>
                            <span>Druckfestigkeit</span>
                        </span>
                        <span class="font-semibold">${cardData.haerte} N/mm¬≤</span>
                    </div>
                    <div class="flex items-center justify-between bg-amber-50/90 rounded-lg px-2 py-1 text-xs shadow-sm">
                        <span class="flex items-center gap-1">
                            <span>‚ÜîÔ∏è</span>
                            <span>Quellen/Schwinden (rad.)</span>
                        </span>
                        <span class="font-semibold">${cardData.quellenSchwindenRadial} %</span>
                    </div>
                    <div class="flex items-center justify-between bg-white/90 rounded-lg px-2 py-1 text-xs shadow-sm">
                        <span class="flex items-center gap-1">
                            <span>‚öñÔ∏è</span>
                            <span>Rohdichte</span>
                        </span>
                        <span class="font-semibold">${cardData.dichte} kg/m¬≥</span>
                    </div>
                    <div class="flex items-center justify-between bg-amber-50/90 rounded-lg px-2 py-1 text-xs shadow-sm">
                        <span class="flex items-center gap-1">
                            <span>üèãÔ∏è</span>
                            <span>E-Modul</span>
                        </span>
                        <span class="font-semibold">${cardData.gewicht} N/mm¬≤</span>
                    </div>
                </div>
                <p class="text-[0.55rem] text-gray-500 mt-2 italic">Tippe auf "Info" f√ºr fachliche Details.</p>
            `;
            back.innerHTML = `<div class="w-full h-full rounded-2xl"></div>`;
            card.appendChild(front);
            card.appendChild(back);
            if (isPlayer && ((mode === 'multi' && localGameState?.turn === localPlayerId && !localGameState?.lastResult) || (mode === 'ai' && aiGame.turn === 'player'))) {
                const attributeSelection = document.getElementById('attributeSelection');
                attributeSelection.innerHTML = `
                    <h3 class="text-base font-semibold text-gray-700 mb-1">W√§hle eine Eigenschaft!</h3>
                    <div class="grid grid-cols-2 gap-2 w-full">
                        <button data-attr="dk" class="bg-amber-50 hover:bg-amber-200 text-gray-900 text-sm py-2 rounded-lg border border-amber-200 transition-colors flex items-center justify-center gap-1">
                            üõ°Ô∏è DK
                        </button>
                        <button data-attr="haerte" class="bg-amber-50 hover:bg-amber-200 text-gray-900 text-sm py-2 rounded-lg border border-amber-200 transition-colors flex items-center justify-center gap-1">
                            üíé Druckfestigkeit
                        </button>
                        <button data-attr="quellenSchwindenRadial" class="bg-amber-50 hover:bg-amber-200 text-gray-900 text-sm py-2 rounded-lg border border-amber-200 transition-colors flex items-center justify-center gap-1 text-center px-1">
                            ‚ÜîÔ∏è Quellen/Schwinden
                        </button>
                        <button data-attr="dichte" class="bg-amber-50 hover:bg-amber-200 text-gray-900 text-sm py-2 rounded-lg border border-amber-200 transition-colors flex items-center justify-center gap-1">
                            ‚öñÔ∏è Dichte
                        </button>
                        <button data-attr="gewicht" class="col-span-2 bg-amber-50 hover:bg-amber-200 text-gray-900 text-sm py-2 rounded-lg border border-amber-200 transition-colors flex items-center justify-center gap-1">
                            üèãÔ∏è E-Modul
                        </button>
                    </div>
                `;
                attributeSelection.querySelectorAll('button[data-attr]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const attr = e.currentTarget.getAttribute('data-attr');
                        if (mode === 'multi') { multiplayerSelectAttribute(attr); }
                        else { selectAttributeAI(attr); }
                    });
                });
            }
            return card;
        }

        function selectAttributeAI(attribute) {
            if (aiGame.turn !== 'player') return;
            const playerValue = aiGame.currentPlayerCard[attribute];
            const aiValue = aiGame.currentAiCard[attribute];
            let playerWins;
            if (attribute === 'quellenSchwindenRadial' || attribute === 'dk') {
                if (playerValue < aiValue) playerWins = true;
                else if (aiValue < playerValue) playerWins = false;
                else playerWins = 'tie';
            } else {
                if (playerValue > aiValue) playerWins = true;
                else if (aiValue > playerValue) playerWins = false;
                else playerWins = 'tie';
            }
            const resultDisplay = document.getElementById('resultDisplay');
            const resultText = document.getElementById('resultText');
            const resultDetails = document.getElementById('resultDetails');
            const attributeSelection = document.getElementById('attributeSelection');
            const nextRoundBtn = document.getElementById('nextRoundButton');
            attributeSelection.classList.add('hidden');
            resultDisplay.classList.remove('hidden');
            nextRoundBtn.classList.remove('hidden');

            if (playerWins === true) {
                playSound(sounds.win);
                triggerWinStarAnimation();
                resultText.textContent = "üéâ Du gewinnst!";
            } else if (playerWins === false) {
                resultText.textContent = "üòû Computer gewinnt!";
            } else {
                resultText.textContent = "ü§ù Unentschieden!";
            }
            resultDetails.textContent = `${attributeInfo[attribute]?.name?.split(' (')[0] || attribute}: ${playerValue} vs ${aiValue}`;
            aiGame.lastWinner = playerWins;
            aiGame.turn = 'aiResolved';
            displayAIGameCards(true);
        }

        function nextRound() {
            if (gameMode === 'multiplayer') {
                multiplayerNextRound();
                return;
            }
            if (aiGame.turn !== 'aiResolved') return;
            const playerCard = aiGame.playerCards.shift();
            const aiCard = aiGame.aiCards.shift();
            if (aiGame.lastWinner === true) {
                if (playerCard) aiGame.playerCards.push(playerCard);
                if (aiCard) aiGame.playerCards.push(aiCard);
            } else if (aiGame.lastWinner === false) {
                if (playerCard) aiGame.aiCards.push(playerCard);
                if (aiCard) aiGame.aiCards.push(aiCard);
            } else {
                if (playerCard) aiGame.playerCards.push(playerCard);
                if (aiCard) aiGame.aiCards.push(aiCard);
            }
            aiGame.currentPlayerCard = aiGame.playerCards[0] || null;
            aiGame.currentAiCard = aiGame.aiCards[0] || null;
            document.getElementById('playerCards').textContent = aiGame.playerCards.length;
            document.getElementById('aiCards').textContent = aiGame.aiCards.length;
            updateStatusBar(aiGame.playerCards.length, aiGame.aiCards.length);

            document.getElementById('resultDisplay').classList.add('hidden');
            document.getElementById('nextRoundButton').classList.add('hidden');

            if (aiGame.playerCards.length === 0 || aiGame.aiCards.length === 0) {
                if (aiGame.playerCards.length > aiGame.aiCards.length) {
                    showReflection();
                } else {
                    showFinalLoseScreen();
                }
            } else {
                aiGame.turn = 'player';
                displayAIGameCards(false);
            }
        }

        function showReflection() {
            document.getElementById('reflectionModal').classList.remove('hidden');
            const question = reflectionQuestions[Math.floor(Math.random() * reflectionQuestions.length)];
            document.getElementById('reflectionQuestion').textContent = question;
        }

        function showFinalWinScreen() {
            document.getElementById('reflectionModal').classList.add('hidden');
            document.getElementById('gameOverModal').classList.remove('hidden');
            document.getElementById('gameOverTitle').textContent = "üéâ Gl√ºckwunsch, du hast gewonnen!";
            document.getElementById('gameOverText').textContent = "Du hast alle Karten erspielt. Sehr gut! Trage dein Ergebnis in der Bestenliste ein.";
            saveWinToLeaderboard(aiGame.playerName || "Unbekannt");
        }

        function showFinalLoseScreen() {
            document.getElementById('gameOverModal').classList.remove('hidden');
            document.getElementById('gameOverTitle').textContent = "üòû Leider verloren";
            document.getElementById('gameOverText').textContent = "Der Computer hat diesmal mehr Karten erspielt. Versuch es erneut!";
        }

        async function saveWinToLeaderboard(playerName) {
            try {
                const leaderboardRef = doc(collection(db, "leaderboard"));
                await setDoc(leaderboardRef, {
                    name: playerName,
                    score: 1,
                    createdAt: serverTimestamp()
                });
            } catch (error) {
                console.error("Error saving to leaderboard:", error);
            }
        }

        async function showLeaderboard() {
            const leaderboardModal = document.getElementById('leaderboardModal');
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '<p class="text-gray-400 text-sm">Lade Bestenliste...</p>';
            leaderboardModal.classList.remove('hidden');
            try {
                const q = query(collection(db, "leaderboard"), orderBy("createdAt", "desc"), limit(20));
                const querySnapshot = await getDocs(q);
                leaderboardList.innerHTML = '';
                let rank = 1;
                querySnapshot.forEach((docu) => {
                    const data = docu.data();
                    const item = document.createElement('div');
                    item.className = 'flex items-center justify-between bg-amber-50 rounded-lg px-3 py-2';
                    item.innerHTML = `
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-bold text-amber-700">${rank}.</span>
                            <span class="text-sm text-gray-700">${data.name || 'Unbekannt'}</span>
                        </div>
                        <span class="text-xs text-gray-500">${data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString('de-DE') : ''}</span>
                    `;
                    leaderboardList.appendChild(item);
                    rank++;
                });
                if (rank === 1) {
                    leaderboardList.innerHTML = '<p class="text-gray-400 text-sm">Noch keine Eintr√§ge.</p>';
                }
            } catch (error) {
                console.error("Error loading leaderboard:", error);
                leaderboardList.innerHTML = '<p class="text-red-400 text-sm">Fehler beim Laden.</p>';
            }
        }

        function closeLeaderboard() {
            document.getElementById('leaderboardModal').classList.add('hidden');
        }

        window.openInfoModal = (woodName) => {
            const info = woodInfo[woodName];
            const modal = document.getElementById('infoModal');
            const title = document.getElementById('infoModalTitle');
            const content = document.getElementById('infoModalContent');
            title.textContent = woodName;
            if (info) {
                content.innerHTML = `
                    <p class="text-sm mb-3">${info.info}</p>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Baum / Stehbild</p>
                            <img src="${info.bildBaum}" alt="${woodName}" class="w-full h-auto rounded-lg border">
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Querschnitt / Holzstruktur</p>
                            <img src="${info.bildQuerschnitt}" alt="${woodName}" class="w-full h-auto rounded-lg border">
                        </div>
                    </div>
                `;
            } else {
                content.innerHTML = `<p class="text-sm">Keine zus√§tzlichen Informationen vorhanden.</p>`;
            }
            modal.classList.remove('hidden');
        };

        window.closeInfoModal = () => {
            document.getElementById('infoModal').classList.add('hidden');
        };

        function triggerWinStarAnimation() {
            const container = document.getElementById('animationContainer');
            if (!container) return;
            playSound(sounds.starWin);
            for (let i = 0; i < 3; i++) {
                const star = document.createElement('div');
                star.className = 'falling-star';
                star.textContent = '‚≠ê';
                const startX = 70 + i * 40;
                const endY = 140 + i * 30;
                star.style.left = startX + 'px';
                star.style.setProperty('--end-y', endY + 'px');
                container.appendChild(star);
                setTimeout(() => { star.remove(); }, 1200);
            }
        }

        // NEU: QR-Code-Helfer (nur hier am Ende eingef√ºgt, damit restlicher Code unver√§ndert bleibt)
        window.generateQRCode = function (url) {
            const qrContainer = document.getElementById('qrContainer');
            if (!qrContainer) return;
            qrContainer.innerHTML = '';
            try {
                new QRCode(qrContainer, {
                    text: url,
                    width: 160,
                    height: 160
                });
            } catch (e) {
                console.warn("QR konnte nicht generiert werden:", e);
            }
        };

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function endGame() {
            document.getElementById('gameOverModal').classList.remove('hidden');
            const myCards = localGameState?.players?.[localPlayerId]?.cards?.length ?? 0;
            const otherId = localGameState?.playerIds?.find(id => id !== localPlayerId);
            const otherCards = otherId ? (localGameState.players[otherId]?.cards?.length ?? 0) : 0;
            if (myCards > otherCards) {
                document.getElementById('gameOverTitle').textContent = "üéâ Du hast gewonnen!";
                document.getElementById('gameOverText').textContent = "Du hattest am Ende mehr Karten als dein Mitspieler.";
            } else if (otherCards > myCards) {
                document.getElementById('gameOverTitle').textContent = "üòû Du hast verloren!";
                document.getElementById('gameOverText').textContent = "Dein Mitspieler hatte am Ende mehr Karten.";
            } else {
                document.getElementById('gameOverTitle').textContent = "ü§ù Unentschieden!";
                document.getElementById('gameOverText').textContent = "Ihr hattet gleich viele Karten.";
            }
        }

        window.resetGame = () => {
            window.location.href = window.location.origin + window.location.pathname;
        };

        const soundToggle = document.getElementById('soundToggle');
        soundToggle.addEventListener('change', (e) => {
            isMuted = !e.target.checked ? false : true;
            // Bei dir war Sound anfangs an ‚Äì also hier invertieren:
            isMuted = !e.target.checked;
        });
        // Standard: Sound an
        soundToggle.checked = true;
        isMuted = false;
    </script>
</body>
</html>
